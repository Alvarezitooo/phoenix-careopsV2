"use strict";(()=>{var e={};e.id=471,e.ids=[471],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2700:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var r={};a.r(r),a.d(r,{POST:()=>l});var s=a(3277),n=a(5265),o=a(5356),i=a(7076);let u=process.env.API_URL||process.env.NEXT_PUBLIC_API_URL||"http://localhost:8000";async function l(e){try{let{document:t,userId:a,documentType:r,fileName:s}=await e.json(),n=e.headers.get("Authorization")||"",o=n.replace("Bearer ","").trim();if(console.log("\uD83D\uDD10 API Route /analyze-document - Headers:",{hasAuth:!!n,authPrefix:n.substring(0,20),hasToken:!!o,tokenPrefix:o.substring(0,20)}),!o)return console.error("❌ Token manquant dans la requ\xeate"),i.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentification requise"}},{status:401});console.log(`📄 Analyse document: ${s} (type: ${r}, user: ${a})`);let l=await fetch(`${u}/api/chat/analyze-document`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({document:t,userId:a,documentType:r,fileName:s})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||`RAG Error: ${l.status}`)}let c=await l.json();return i.NextResponse.json({analysis:c.analysis||c.fullAnalysis,fullAnalysis:c.fullAnalysis||c.analysis,suggestions:c.suggestions||[],fileName:c.fileName||s,timestamp:c.timestamp})}catch(e){return console.error("Erreur API analyze-document:",e),i.NextResponse.json({error:{code:"ANALYSIS_ERROR",message:e.message||"Erreur lors de l'analyse du document"}},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/analyze-document/route",pathname:"/api/chat/analyze-document",filename:"route",bundlePath:"app/api/chat/analyze-document/route"},resolvedPagePath:"/Users/mattvaness/Desktop/IA/phoenix-careops/client/app/api/chat/analyze-document/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=c,h="/api/chat/analyze-document/route";function y(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[942,786],()=>a(2700));module.exports=r})();