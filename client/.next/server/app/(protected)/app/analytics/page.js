(()=>{var e={};e.id=780,e.ids=[780],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},5017:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>d,originalPathname:()=>h,pages:()=>u,routeModule:()=>p,tree:()=>l}),s(7662),s(6277),s(5474),s(2874),s(1163);var r=s(7105),i=s(5265),a=s(157),n=s.n(a),c=s(4665),o={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>c[e]);s.d(t,o);let l=["",{children:["(protected)",{children:["app",{children:["analytics",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7662)),"/Users/mattvaness/Desktop/IA/phoenix-careops/client/app/(protected)/app/analytics/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,6277)),"/Users/mattvaness/Desktop/IA/phoenix-careops/client/app/(protected)/app/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,5474)),"/Users/mattvaness/Desktop/IA/phoenix-careops/client/app/(protected)/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,2874,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1163)),"/Users/mattvaness/Desktop/IA/phoenix-careops/client/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,2874,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/mattvaness/Desktop/IA/phoenix-careops/client/app/(protected)/app/analytics/page.tsx"],h="/(protected)/app/analytics/page",d={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(protected)/app/analytics/page",pathname:"/app/analytics",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},9156:(e,t,s)=>{Promise.resolve().then(s.bind(s,7340))},4868:()=>{},7340:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var r=s(9899),i=s(8277),a=s(6641),n=s(5298),c=s(9028),o=s(6512),l=s(7973),u=s(7768),h=class extends c.l{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#s=(0,o.O)(),this.bindMethods(),this.setOptions(t)}#e;#r=void 0;#i=void 0;#a=void 0;#n;#c;#s;#t;#o;#l;#u;#h;#d;#p;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#r.addObserver(this),d(this.#r,this.options)?this.#f():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return p(this.#r,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return p(this.#r,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#y(),this.#g(),this.#r.removeObserver(this)}setOptions(e){let t=this.options,s=this.#r;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,l.Nc)(this.options.enabled,this.#r))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#v(),this.#r.setOptions(this.options),t._defaulted&&!(0,l.VS)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#r,observer:this});let r=this.hasListeners();r&&m(this.#r,s,this.options,t)&&this.#f(),this.updateResult(),r&&(this.#r!==s||(0,l.Nc)(this.options.enabled,this.#r)!==(0,l.Nc)(t.enabled,this.#r)||(0,l.KC)(this.options.staleTime,this.#r)!==(0,l.KC)(t.staleTime,this.#r))&&this.#b();let i=this.#R();r&&(this.#r!==s||(0,l.Nc)(this.options.enabled,this.#r)!==(0,l.Nc)(t.enabled,this.#r)||i!==this.#p)&&this.#j(i)}getOptimisticResult(e){let t=this.#e.getQueryCache().build(this.#e,e),s=this.createResult(t,e);return(0,l.VS)(this.getCurrentResult(),s)||(this.#a=s,this.#c=this.options,this.#n=this.#r.state),s}getCurrentResult(){return this.#a}trackResult(e,t){return new Proxy(e,{get:(e,s)=>(this.trackProp(s),t?.(s),"promise"!==s||this.options.experimental_prefetchInRender||"pending"!==this.#s.status||this.#s.reject(Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(e,s))})}trackProp(e){this.#m.add(e)}getCurrentQuery(){return this.#r}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#f({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#a))}#f(e){this.#v();let t=this.#r.fetch(this.options,e);return e?.throwOnError||(t=t.catch(l.ZT)),t}#b(){this.#y();let e=(0,l.KC)(this.options.staleTime,this.#r);if(l.sk||this.#a.isStale||!(0,l.PN)(e))return;let t=(0,l.Kp)(this.#a.dataUpdatedAt,e);this.#h=u.mr.setTimeout(()=>{this.#a.isStale||this.updateResult()},t+1)}#R(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#r):this.options.refetchInterval)??!1}#j(e){this.#g(),this.#p=e,!l.sk&&!1!==(0,l.Nc)(this.options.enabled,this.#r)&&(0,l.PN)(this.#p)&&0!==this.#p&&(this.#d=u.mr.setInterval(()=>{(this.options.refetchIntervalInBackground||i.j.isFocused())&&this.#f()},this.#p))}#x(){this.#b(),this.#j(this.#R())}#y(){this.#h&&(u.mr.clearTimeout(this.#h),this.#h=void 0)}#g(){this.#d&&(u.mr.clearInterval(this.#d),this.#d=void 0)}createResult(e,t){let s;let r=this.#r,i=this.options,a=this.#a,c=this.#n,u=this.#c,h=e!==r?e.state:this.#i,{state:p}=e,x={...p},y=!1;if(t._optimisticResults){let s=this.hasListeners(),a=!s&&d(e,t),c=s&&m(e,r,t,i);(a||c)&&(x={...x,...(0,n.z)(p.data,e.options)}),"isRestoring"===t._optimisticResults&&(x.fetchStatus="idle")}let{error:g,errorUpdatedAt:v,status:b}=x;s=x.data;let R=!1;if(void 0!==t.placeholderData&&void 0===s&&"pending"===b){let e;a?.isPlaceholderData&&t.placeholderData===u?.placeholderData?(e=a.data,R=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#u?.state.data,this.#u):t.placeholderData,void 0!==e&&(b="success",s=(0,l.oE)(a?.data,e,t),y=!0)}if(t.select&&void 0!==s&&!R){if(a&&s===c?.data&&t.select===this.#o)s=this.#l;else try{this.#o=t.select,s=t.select(s),s=(0,l.oE)(a?.data,s,t),this.#l=s,this.#t=null}catch(e){this.#t=e}}this.#t&&(g=this.#t,s=this.#l,v=Date.now(),b="error");let j="fetching"===x.fetchStatus,_="pending"===b,Q="error"===b,C=_&&j,D=void 0!==s,N={status:b,fetchStatus:x.fetchStatus,isPending:_,isSuccess:"success"===b,isError:Q,isInitialLoading:C,isLoading:C,data:s,dataUpdatedAt:x.dataUpdatedAt,error:g,errorUpdatedAt:v,failureCount:x.fetchFailureCount,failureReason:x.fetchFailureReason,errorUpdateCount:x.errorUpdateCount,isFetched:x.dataUpdateCount>0||x.errorUpdateCount>0,isFetchedAfterMount:x.dataUpdateCount>h.dataUpdateCount||x.errorUpdateCount>h.errorUpdateCount,isFetching:j,isRefetching:j&&!_,isLoadingError:Q&&!D,isPaused:"paused"===x.fetchStatus,isPlaceholderData:y,isRefetchError:Q&&D,isStale:f(e,t),refetch:this.refetch,promise:this.#s,isEnabled:!1!==(0,l.Nc)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=e=>{"error"===N.status?e.reject(N.error):void 0!==N.data&&e.resolve(N.data)},s=()=>{t(this.#s=N.promise=(0,o.O)())},i=this.#s;switch(i.status){case"pending":e.queryHash===r.queryHash&&t(i);break;case"fulfilled":("error"===N.status||N.data!==i.value)&&s();break;case"rejected":("error"!==N.status||N.error!==i.reason)&&s()}}return N}updateResult(){let e=this.#a,t=this.createResult(this.#r,this.options);this.#n=this.#r.state,this.#c=this.options,void 0!==this.#n.data&&(this.#u=this.#r),(0,l.VS)(t,e)||(this.#a=t,this.#_({listeners:(()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!this.#m.size)return!0;let r=new Set(s??this.#m);return this.options.throwOnError&&r.add("error"),Object.keys(this.#a).some(t=>this.#a[t]!==e[t]&&r.has(t))})()}))}#v(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#r)return;let t=this.#r;this.#r=e,this.#i=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#_(e){a.Vr.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#a)}),this.#e.getQueryCache().notify({query:this.#r,type:"observerResultsUpdated"})})}};function d(e,t){return!1!==(0,l.Nc)(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)||void 0!==e.state.data&&p(e,t,t.refetchOnMount)}function p(e,t,s){if(!1!==(0,l.Nc)(t.enabled,e)&&"static"!==(0,l.KC)(t.staleTime,e)){let r="function"==typeof s?s(e):s;return"always"===r||!1!==r&&f(e,t)}return!1}function m(e,t,s,r){return(e!==t||!1===(0,l.Nc)(r.enabled,e))&&(!s.suspense||"error"!==e.state.status)&&f(e,s)}function f(e,t){return!1!==(0,l.Nc)(t.enabled,e)&&e.isStaleByTime((0,l.KC)(t.staleTime,e))}var x=s(5507),y=s(1206),g=x.createContext(function(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}()),v=()=>x.useContext(g),b=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&!t.isReset()&&(e.retryOnMount=!1)},R=e=>{x.useEffect(()=>{e.clearReset()},[e])},j=({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(i&&void 0===e.data||(0,l.L3)(s,[e.error,r])),_=x.createContext(!1),Q=()=>x.useContext(_);_.Provider;var C=e=>{if(e.suspense){let t=e=>"static"===e?e:Math.max(e??1e3,1e3),s=e.staleTime;e.staleTime="function"==typeof s?(...e)=>t(s(...e)):t(s),"number"==typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,1e3))}},D=(e,t)=>e.isLoading&&e.isFetching&&!t,N=(e,t)=>e?.suspense&&t.isPending,w=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function I(e,t){return function(e,t,s){let r=Q(),i=v(),n=(0,y.NL)(s),c=n.defaultQueryOptions(e);n.getDefaultOptions().queries?._experimental_beforeQuery?.(c),c._optimisticResults=r?"isRestoring":"optimistic",C(c),b(c,i),R(i);let o=!n.getQueryCache().get(c.queryHash),[u]=x.useState(()=>new t(n,c)),h=u.getOptimisticResult(c),d=!r&&!1!==e.subscribed;if(x.useSyncExternalStore(x.useCallback(e=>{let t=d?u.subscribe(a.Vr.batchCalls(e)):l.ZT;return u.updateResult(),t},[u,d]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),x.useEffect(()=>{u.setOptions(c)},[c,u]),N(c,h))throw w(c,u,i);if(j({result:h,errorResetBoundary:i,throwOnError:c.throwOnError,query:n.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw h.error;if(n.getDefaultOptions().queries?._experimental_afterQuery?.(c,h),c.experimental_prefetchInRender&&!l.sk&&D(h,r)){let e=o?w(c,u,i):n.getQueryCache().get(c.queryHash)?.promise;e?.catch(l.ZT).finally(()=>{u.updateResult()})}return c.notifyOnChangeProps?h:u.trackResult(h)}(e,h,t)}let T=process.env.NEXT_PUBLIC_API_URL||"http://localhost:8000";function k(){let{data:e,isLoading:t}=I({queryKey:["analytics","overview"],queryFn:async()=>{let e=await fetch(`${T}/api/analytics/overview`);if(!e.ok)throw Error("Failed to fetch analytics overview");return e.json()},staleTime:3e5,refetchInterval:3e5}),{data:s,isLoading:i}=function(e=20){return I({queryKey:["analytics","top-questions",e],queryFn:async()=>{let t=await fetch(`${T}/api/analytics/top-questions?limit=${e}`);if(!t.ok)throw Error("Failed to fetch top questions");return t.json()},staleTime:6e5})}(10),{data:a,isLoading:n}=function(e=20){return I({queryKey:["analytics","knowledge-gaps",e],queryFn:async()=>{let t=await fetch(`${T}/api/analytics/knowledge-gaps?limit=${e}`);if(!t.ok)throw Error("Failed to fetch knowledge gaps");return t.json()},staleTime:6e5})}(10);return t?(0,r.jsxs)("div",{className:"p-8",children:[r.jsx("h1",{className:"text-2xl font-bold mb-4",children:"\uD83D\uDCCA Analytics Dashboard"}),r.jsx("p",{children:"Chargement..."})]}):(0,r.jsxs)("div",{className:"p-8 max-w-7xl mx-auto",children:[r.jsx("h1",{className:"text-3xl font-bold mb-8",children:"\uD83D\uDCCA Analytics Dashboard"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[r.jsx(q,{title:"Interactions (30j)",value:e?.total_interactions_30d||0,icon:"\uD83D\uDCAC"}),r.jsx(q,{title:"Utilisateurs uniques",value:e?.unique_users_30d||0,icon:"\uD83D\uDC65"}),r.jsx(q,{title:"Cache Hit Rate",value:`${e?.avg_cache_hit_rate||0}%`,icon:"⚡"}),r.jsx(q,{title:"Temps de r\xe9ponse",value:`${Math.round(e?.avg_response_time_ms||0)}ms`,icon:"⏱️"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsxs)("section",{className:"bg-white rounded-lg shadow p-6",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"\uD83D\uDCC8 Top Questions"}),i?r.jsx("p",{children:"Chargement..."}):r.jsx("div",{className:"space-y-3",children:s&&s.length>0?s.map((e,t)=>(0,r.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4 py-2",children:[r.jsx("p",{className:"font-medium text-sm",children:e.question}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.count," fois • ",Math.round(e.avg_time_ms),"ms"]})]},t)):r.jsx("p",{className:"text-gray-500",children:"Aucune donn\xe9e disponible"})})]}),(0,r.jsxs)("section",{className:"bg-white rounded-lg shadow p-6",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"\uD83D\uDD0D Gaps Knowledge Base"}),r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Questions sans sources → Docs \xe0 ajouter"}),n?r.jsx("p",{children:"Chargement..."}):r.jsx("div",{className:"space-y-3",children:a&&a.length>0?a.map((e,t)=>(0,r.jsxs)("div",{className:"border-l-4 border-red-500 pl-4 py-2",children:[r.jsx("p",{className:"font-medium text-sm",children:e.question}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.count," fois • ",new Date(e.created_at).toLocaleDateString("fr-FR")]})]},t)):r.jsx("p",{className:"text-green-600",children:"✅ Aucun gap d\xe9tect\xe9 ! Toutes les questions ont des sources."})})]})]}),(0,r.jsxs)("section",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[r.jsx("h3",{className:"font-bold text-lg mb-3",children:"\uD83D\uDCA1 Actions Recommand\xe9es"}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm",children:[a&&a.length>0&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-red-500",children:"⚠️"}),(0,r.jsxs)("span",{children:[(0,r.jsxs)("strong",{children:[a.length," questions sans sources"]})," - Ajouter des documents pour combler ces gaps"]})]}),e&&e.avg_cache_hit_rate<50&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-yellow-500",children:"⚠️"}),(0,r.jsxs)("span",{children:[(0,r.jsxs)("strong",{children:["Cache hit rate faible (",e.avg_cache_hit_rate,"%)"]})," - Optimiser le cache TTL"]})]}),e&&e.avg_response_time_ms>3e3&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-yellow-500",children:"⚠️"}),(0,r.jsxs)("span",{children:[(0,r.jsxs)("strong",{children:["Temps de r\xe9ponse \xe9lev\xe9 (",Math.round(e.avg_response_time_ms),"ms)"]})," - Envisager optimisation RAG"]})]}),(!a||0===a.length)&&e&&e.avg_cache_hit_rate>=50&&e.avg_response_time_ms<=3e3&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-green-500",children:"✅"}),(0,r.jsxs)("span",{children:[r.jsx("strong",{children:"Tout est optimal !"})," Continue comme \xe7a \uD83D\uDE80"]})]})]})]})]})}function q({title:e,value:t,icon:s}){return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("p",{className:"text-sm text-gray-600",children:e}),r.jsx("span",{className:"text-2xl",children:s})]}),r.jsx("p",{className:"text-3xl font-bold",children:t})]})}},7866:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(1278).Z)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]])},4941:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(1278).Z)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},7282:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(1278).Z)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},4767:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(1278).Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},4175:(e,t,s)=>{"use strict";s.d(t,{default:()=>i.a});var r=s(696),i=s.n(r)},6153:(e,t,s)=>{"use strict";var r=s(1545);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},7662:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(2772).createProxy)(String.raw`/Users/mattvaness/Desktop/IA/phoenix-careops/client/app/(protected)/app/analytics/page.tsx#default`)},6277:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a,dynamic:()=>i});var r=s(5023);let i="force-dynamic";function a({children:e}){return r.jsx(r.Fragment,{children:e})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[942,237,696,838],()=>s(5017));module.exports=r})();