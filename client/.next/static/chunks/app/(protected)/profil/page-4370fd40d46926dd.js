(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[659],{9218:function(e,t,s){Promise.resolve().then(s.bind(s,7085))},7085:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(7821),r=s(8078),n=s(5706),l=s(8304),i=s(9905),c=s(5118),o=s(750),u=s(9086),d=s(9198),m=s(961),p=s(5189),h=s(6576);let f=(0,h.Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),x=(0,h.Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var b=s(5758);function g(){let{user:e}=(0,n.K)(),{profile:t,children:s,loading:h}=(0,l.mH)(),[g,y]=(0,r.useState)({name:"",departement:"",situation:"parent_solo"}),[v,j]=(0,r.useState)([]),[N,w]=(0,r.useState)(!1),[k,S]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&y({name:t.name||"",departement:t.departement||"",situation:t.situation||"parent_solo"}),s&&s.length>0&&j(s.map(e=>({id:e.id,name:e.name||"",age:e.age||"",handicap_type:e.handicap_type||"",description:e.description||""})))},[t,s]);let _=()=>{j([...v,{name:"",age:"",handicap_type:"",description:""}])},Z=e=>{j(v.filter((t,s)=>s!==e))},I=(e,t,s)=>{let a=[...v];a[e]={...a[e],[t]:s},j(a)},C=async()=>{w(!0),S(null);try{if(!e)throw Error("Non connect\xe9");let{data:s,error:a}=await i.supabase.from("family_profiles").upsert([{user_id:e.id,name:g.name,departement:g.departement,situation:g.situation,nb_enfants:v.length,updated_at:new Date().toISOString()}],{onConflict:"user_id"}).select().single();if(a)throw a;if((null==t?void 0:t.id)&&await i.supabase.from("children").delete().eq("family_id",s.id),v.length>0){let e=v.filter(e=>""!==e.name.trim()).map(e=>({family_id:s.id,name:e.name,age:""===e.age?null:Number(e.age),handicap_type:e.handicap_type,description:e.description||null}));if(e.length>0){let{error:t}=await i.supabase.from("children").insert(e);if(t)throw t}}S({type:"success",text:"Profil enregistr\xe9 avec succ\xe8s !"}),setTimeout(()=>window.location.reload(),1500)}catch(e){console.error("Erreur sauvegarde profil:",e),S({type:"error",text:e.message||"Erreur lors de la sauvegarde"})}finally{w(!1)}};return h?(0,a.jsx)("div",{className:"h-full bg-slate-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(c.Z,{className:"h-12 w-12 text-rose-500 animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Chargement de votre profil..."})]})}):(0,a.jsx)("div",{className:"h-full bg-slate-50 overflow-auto",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Mon Profil Famille"}),(0,a.jsx)("p",{className:"text-slate-600 mt-2",children:"Ces informations permettent \xe0 Phoenix de personnaliser ses r\xe9ponses"})]}),k&&(0,a.jsxs)("div",{className:"mb-6 p-4 rounded-lg flex items-center space-x-2 ".concat("success"===k.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:["success"===k.type?(0,a.jsx)(o.Z,{className:"h-5 w-5"}):(0,a.jsx)(u.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:k.text})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-slate-900 mb-6 flex items-center space-x-2",children:[(0,a.jsx)(d.Z,{className:"h-6 w-6 text-rose-500"}),(0,a.jsx)("span",{children:"Informations parent r\xe9f\xe9rent"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nom complet"}),(0,a.jsx)("input",{type:"text",value:g.name,onChange:e=>y({...g,name:e.target.value}),placeholder:"Pr\xe9nom Nom",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"D\xe9partement"}),(0,a.jsx)("input",{type:"text",value:g.departement,onChange:e=>y({...g,departement:e.target.value}),placeholder:"75 (Paris), 69 (Rh\xf4ne), etc.",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Situation familiale"}),(0,a.jsxs)("select",{value:g.situation,onChange:e=>y({...g,situation:e.target.value}),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"parent_solo",children:"Parent solo"}),(0,a.jsx)("option",{value:"couple",children:"En couple"}),(0,a.jsx)("option",{value:"autre",children:"Autre"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-slate-900 flex items-center space-x-2",children:[(0,a.jsx)(m.Z,{className:"h-6 w-6 text-rose-500"}),(0,a.jsxs)("span",{children:["Mes enfants (",v.length,")"]})]}),(0,a.jsxs)("button",{onClick:_,className:"bg-rose-500 text-white px-4 py-2 rounded-lg hover:bg-rose-600 transition-colors flex items-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Ajouter un enfant"})]})]}),0===v.length?(0,a.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,a.jsx)(m.Z,{className:"h-12 w-12 text-slate-300 mx-auto mb-4"}),(0,a.jsx)("p",{children:"Aucun enfant enregistr\xe9"}),(0,a.jsx)("button",{onClick:_,className:"mt-4 text-rose-600 hover:text-rose-700 font-medium",children:"Ajouter votre premier enfant"})]}):(0,a.jsx)("div",{className:"space-y-6",children:v.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4 relative",children:[(0,a.jsx)("button",{onClick:()=>Z(t),className:"absolute top-2 right-2 p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Supprimer cet enfant",children:(0,a.jsx)(f,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 pr-12",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Pr\xe9nom *"}),(0,a.jsx)("input",{type:"text",value:e.name,onChange:e=>I(t,"name",e.target.value),placeholder:"Pr\xe9nom de l'enfant",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"\xc2ge"}),(0,a.jsx)("input",{type:"number",value:e.age,onChange:e=>I(t,"age",""===e.target.value?"":parseInt(e.target.value)),placeholder:"\xc2ge",min:"0",max:"30",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Type de handicap ou trouble"}),(0,a.jsx)("input",{type:"text",value:e.handicap_type,onChange:e=>I(t,"handicap_type",e.target.value),placeholder:"Autisme, trisomie 21, troubles DYS, etc.",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notes compl\xe9mentaires (optionnel)"}),(0,a.jsx)("textarea",{value:e.description||"",onChange:e=>I(t,"description",e.target.value),placeholder:"Besoins sp\xe9cifiques, accompagnement, etc.",rows:2,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent"})]})]})]},t))})]}),(0,a.jsx)("div",{className:"flex justify-end space-x-4",children:(0,a.jsx)("button",{onClick:C,disabled:N||!g.name.trim(),className:"bg-rose-500 text-white px-8 py-3 rounded-lg hover:bg-rose-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 animate-spin"}),(0,a.jsx)("span",{children:"Enregistrement..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Enregistrer mon profil"})]})})}),(0,a.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,a.jsx)("p",{className:"font-medium mb-1",children:"Pourquoi ces informations ?"}),(0,a.jsx)("p",{className:"text-blue-700",children:"Phoenix utilise votre profil pour personnaliser ses r\xe9ponses et vous proposer les aides adapt\xe9es \xe0 votre situation familiale et votre d\xe9partement."})]})]})})]})})}},5706:function(e,t,s){"use strict";s.d(t,{H:function(){return i},K:function(){return c}});var a=s(7821),r=s(8078),n=s(9905);let l=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[s,i]=(0,r.useState)(null),[c,o]=(0,r.useState)(null),[u,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{n.supabase.auth.getSession().then(e=>{var t;let{data:{session:s}}=e;o(s),i(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),d(!1)});let{data:{subscription:e}}=n.supabase.auth.onAuthStateChange((e,t)=>{var s;o(t),i(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),d(!1)});return()=>e.unsubscribe()},[]);let m=async(e,t,s)=>{let{data:a,error:r}=await n.supabase.auth.signUp({email:e,password:t,options:{data:{name:s}}});return{data:a,error:r}},p=async(e,t)=>{let{data:s,error:a}=await n.supabase.auth.signInWithPassword({email:e,password:t});return{data:s,error:a}},h=async()=>{await n.supabase.auth.signOut()},f=async e=>{let{data:t,error:s}=await n.supabase.auth.resetPasswordForEmail(e);return{data:t,error:s}};return(0,a.jsx)(l.Provider,{value:{user:s,session:c,loading:u,signUp:m,signIn:p,signOut:h,resetPassword:f},children:t})}function c(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useSupabaseAuth must be used within an AuthProvider");return e}},8304:function(e,t,s){"use strict";s.d(t,{GK:function(){return i},fN:function(){return l},hT:function(){return c},mH:function(){return o}});var a=s(8078),r=s(9905),n=s(5706);function l(){let{user:e}=(0,n.K)(),[t,s]=(0,a.useState)([]),[l,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e){i(!1);return}(async()=>{try{let{data:t,error:a}=await r.supabase.from("user_aides").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(a)throw a;s(t||[])}catch(e){o(e.message)}finally{i(!1)}})()},[e]),{aides:t,loading:l,error:c}}function i(){let{user:e}=(0,n.K)(),[t,s]=(0,a.useState)([]),[l,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e){i(!1);return}(async()=>{try{let{data:t,error:a}=await r.supabase.from("user_documents").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(a)throw a;s(t||[])}catch(e){o(e.message)}finally{i(!1)}})()},[e]),{documents:t,loading:l,error:c}}function c(){let{user:e}=(0,n.K)(),[t,s]=(0,a.useState)([]),[l,i]=(0,a.useState)(!0),[c,o]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e){i(!1);return}(async()=>{try{let{data:t,error:a}=await r.supabase.from("user_deadlines").select("*").eq("user_id",e.id).order("date",{ascending:!0});if(a)throw a;s(t||[])}catch(e){o(e.message)}finally{i(!1)}})()},[e]),{deadlines:t,loading:l,error:c}}function o(){let{user:e}=(0,n.K)(),[t,s]=(0,a.useState)(null),[l,i]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0),[u,d]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e){o(!1);return}(async()=>{try{let{data:t,error:a}=await r.supabase.from("family_profiles").select("*").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw a;if(s(t),t){let{data:e,error:s}=await r.supabase.from("children").select("*").eq("family_id",t.id);if(s)throw s;i(e||[])}}catch(e){d(e.message)}finally{o(!1)}})()},[e]),{profile:t,children:l,loading:c,error:u}}},9905:function(e,t,s){"use strict";s.d(t,{supabase:function(){return l}});var a=s(1620);let r="https://gvginoszwaccifrtackh.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd2Z2lub3N6d2FjY2lmcnRhY2toIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxMjQyNzgsImV4cCI6MjA3NDcwMDI3OH0.sbuGET5VLfo0VjwVugc_ix1F_b0ntqDVmrqckdP22ss";if(!r||!n)throw Error("Missing Supabase environment variables");let l=(0,a.eI)(r,n,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce",storage:{getItem:e=>{var t;return(null===(t=document.cookie.split("; ").find(t=>t.startsWith("".concat(e,"="))))||void 0===t?void 0:t.split("=")[1])||null},setItem:(e,t)=>{document.cookie="".concat(e,"=").concat(t,"; path=/; max-age=31536000; SameSite=Lax")},removeItem:e=>{document.cookie="".concat(e,"=; path=/; max-age=0")}}}})},9086:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6576).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},750:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6576).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5118:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6576).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5758:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6576).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},5189:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6576).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9198:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6576).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},961:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(6576).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}},function(e){e.O(0,[129,115,571,744],function(){return e(e.s=9218)}),_N_E=e.O()}]);