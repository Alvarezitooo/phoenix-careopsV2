(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[619],{447:function(e,t,s){Promise.resolve().then(s.bind(s,6528))},6528:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var r=s(7821),n=s(8078),a=s(432),o=s(750),i=s(5118),c=s(9086),l=s(6576);let u=(0,l.Z)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var d=s(6515);let m=(0,l.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var h=s(6446),x=s(5338);async function p(e){if(e.response)try{var t;let s=await e.response.json(),r=null===(t=s.error)||void 0===t?void 0:t.code;if(r&&x.P.errors[r])return x.P.errors[r]}catch(e){return x.P.errors.UNKNOWN_ERROR}return e.message.includes("Failed to fetch")?x.P.errors.network:x.P.errors.UNKNOWN_ERROR}class f{async sendMessage(e,t){let s=await fetch("".concat(this.baseUrl,"/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,userId:t})});if(!s.ok)throw Error("Erreur ".concat(s.status,": ").concat(s.statusText));return s.json()}async getChatHistory(e){let t=await fetch("".concat(this.baseUrl,"/history?userId=").concat(e));if(!t.ok)throw Error("Erreur ".concat(t.status,": ").concat(t.statusText));return t.json()}async saveMemory(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"general",r=await fetch("".concat(this.baseUrl,"/memory"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,memory:t,type:s})});if(!r.ok)throw Error("Erreur ".concat(r.status,": ").concat(r.statusText));return r.json()}async resetConversation(e){let t=await fetch("".concat(this.baseUrl,"/reset"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})});if(!t.ok)throw Error("Erreur ".concat(t.status,": ").concat(t.statusText));return t.json()}async analyzeDocument(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"other",r=await fetch("".concat(this.baseUrl,"/analyze-document"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({document:e,userId:t,documentType:s})});if(!r.ok)throw Error("Erreur ".concat(r.status,": ").concat(r.statusText));return r.json()}async getUserMemory(e){let t=await fetch("".concat(this.baseUrl,"/memory/").concat(e));if(!t.ok)throw Error("Erreur ".concat(t.status,": ").concat(t.statusText));return t.json()}async updateUserMemory(e,t){let s=await fetch("".concat(this.baseUrl,"/memory/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({memoryUpdate:t})});if(!s.ok)throw Error("Erreur ".concat(s.status,": ").concat(s.statusText));return s.json()}async healthCheck(){let e=await fetch("/api/health");if(!e.ok)throw Error("Service indisponible: ".concat(e.status));return e.json()}constructor(){this.baseUrl="/api/chat"}}new f;let g=e=>{let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/6e4),r=Math.floor(s/60),n=Math.floor(r/24);return s<1?"\xc0 l'instant":s<60?"Il y a ".concat(s," min"):r<24?"Il y a ".concat(r,"h"):n<7?"Il y a ".concat(n," jour").concat(n>1?"s":""):t.toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})},b=e=>{let t=new Date(e);return new Date().getTime()-t.getTime()<3e5};function v(e){let{userId:t,className:l="",initialMessage:x,userContext:f}=e,[v,j]=(0,n.useState)(""),[y,w]=(0,n.useState)(!1),N=(0,n.useRef)(null),C=(0,n.useRef)(null),{messages:E,isLoading:D,error:S,connectionStatus:_,sendMessage:k,resetConversation:P,saveMemory:A,retry:T,isEmpty:I}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{userId:t,autoLoadHistory:r=!0,userContext:a}=e,[o,i]=(0,n.useState)({messages:[],isLoading:!1,error:null,connectionStatus:"disconnected"}),c=(0,n.useRef)(null);(0,n.useEffect)(()=>{r&&t&&l()},[t,r]);let l=(0,n.useCallback)(async()=>{if(!t){i(e=>({...e,isLoading:!1,connectionStatus:"disconnected"}));return}try{i(e=>({...e,isLoading:!0,connectionStatus:"connecting"}));let e=await fetch("/api/chat/history?userId=".concat(t));if(!e.ok)throw{response:e};let s=await e.json();i(e=>({...e,messages:s.messages||[],isLoading:!1,connectionStatus:"connected",error:null}))}catch(t){console.error("Erreur chargement historique:",t);let e=await p(t);i(t=>({...t,isLoading:!1,connectionStatus:"disconnected",error:e}))}},[t]),u=(0,n.useCallback)(async e=>{if(!e.trim()||o.isLoading||!t)return;c.current&&c.current.abort(),c.current=new AbortController;let r={id:"user-".concat(Date.now()),role:"user",content:e.trim(),timestamp:new Date().toISOString()};i(e=>({...e,messages:[...e.messages,r],isLoading:!0,error:null}));try{let{supabase:r}=await Promise.resolve().then(s.bind(s,9905)),{data:{session:n}}=await r.auth.getSession(),o=null==n?void 0:n.access_token;if(!o)throw Error("Session expir\xe9e");let l=await fetch("/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({message:e.trim(),userId:t,context:a}),signal:c.current.signal});if(!l.ok)throw{response:l};let u=await l.json(),d={id:"assistant-".concat(Date.now()),role:"assistant",content:u.response||u.answer,timestamp:u.timestamp,sources:u.sources||[],processing_time:u.processing_time||0,suggestions:u.suggestions||[]};i(e=>({...e,messages:[...e.messages,d],isLoading:!1,connectionStatus:"connected"}))}catch(t){if("AbortError"===t.name)return;console.error("Erreur envoi message:",t);let e=await p(t);i(t=>({...t,isLoading:!1,connectionStatus:"disconnected",error:e}))}},[t,o.isLoading]),d=(0,n.useCallback)(async()=>{if(t)try{if(i(e=>({...e,isLoading:!0})),!(await fetch("/api/chat/reset",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})})).ok)throw Error("Erreur lors de la r\xe9initialisation");i(e=>({...e,messages:[],isLoading:!1,error:null}))}catch(e){console.error("Erreur reset:",e),i(t=>({...t,isLoading:!1,error:e.message}))}},[t]),m=(0,n.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"important";if(!t)return!1;try{if(!(await fetch("/api/chat/memory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,memory:e,type:s})})).ok)throw Error("Erreur sauvegarde m\xe9moire");return!0}catch(e){return console.error("Erreur sauvegarde m\xe9moire:",e),!1}},[t]),h=(0,n.useCallback)(async(e,s)=>{if(!t)return null;try{i(e=>({...e,isLoading:!0}));let r=await fetch("/api/chat/analyze-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({document:e,userId:t,documentType:s})});if(!r.ok)throw Error("Erreur analyse document");let n=await r.json(),a={id:"analysis-".concat(Date.now()),role:"assistant",content:"\uD83D\uDCC4 **Analyse de votre document :**\n\n".concat(n.analysis,"\n\n**Suggestions :**\n").concat(n.suggestions.map(e=>"• ".concat(e)).join("\n")),timestamp:new Date().toISOString()};return i(e=>({...e,messages:[...e.messages,a],isLoading:!1})),n}catch(e){return console.error("Erreur analyse document:",e),i(t=>({...t,isLoading:!1,error:e.message})),null}},[t]),x=(0,n.useCallback)(()=>{if(o.messages.length>0){let e=[...o.messages].reverse().find(e=>"user"===e.role);e&&(i(e=>({...e,messages:e.messages.filter(e=>!e.id.startsWith("error-")),error:null})),u(e.content))}},[o.messages,u]);return{messages:o.messages,isLoading:o.isLoading,error:o.error,connectionStatus:o.connectionStatus,sendMessage:u,resetConversation:d,saveMemory:m,analyzeDocument:h,loadChatHistory:l,retry:x,isEmpty:0===o.messages.length,lastMessage:o.messages[o.messages.length-1]||null}}({userId:t,autoLoadHistory:!0,userContext:f});if(!t)return(0,r.jsx)("div",{className:"flex items-center justify-center h-full bg-slate-50 ".concat(l),children:(0,r.jsxs)("div",{className:"text-center max-w-md space-y-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto",children:(0,r.jsx)(a.Z,{className:"h-8 w-8 text-rose-500"})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"Session expir\xe9e"}),(0,r.jsx)("p",{className:"text-slate-600",children:"Merci de vous reconnecter pour continuer \xe0 discuter avec Phoenix. Votre s\xe9curit\xe9 passe avant tout."})]})});(0,n.useEffect)(()=>{var e;null===(e=N.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[E]),(0,n.useEffect)(()=>{x&&!v&&(j(x),setTimeout(()=>{var e;null===(e=C.current)||void 0===e||e.focus()},100))},[x,v]),(0,n.useEffect)(()=>{if(!D){var e;null===(e=C.current)||void 0===e||e.focus()}},[D]);let M=async e=>{if(e.preventDefault(),!v.trim()||D)return;let t=v.trim();j(""),w(!1),await k(t)},O=async e=>{let t={hello:"Bonjour Phoenix, j'aurais besoin d'aide pour accompagner mon enfant.",aeeh_calc:"Mon enfant a un handicap. Puis-je avoir l'AEEH et \xe0 combien ai-je droit ?",parent_solo:"Je suis parent isol\xe9 avec un enfant handicap\xe9. Quelles majorations puis-je avoir ?",aesh_demande:"Mon enfant entre \xe0 l'\xe9cole. Comment demander un AESH ?",dossier_mdph:"Je dois constituer un dossier MDPH. Quels documents dois-je pr\xe9parer ?",cumul_aides:"Puis-je cumuler AEEH, allocations familiales et ARS ?",recours_mdph:"Ma demande MDPH a \xe9t\xe9 refus\xe9e. Comment faire un recours ?",caf_handicap:"Quelles aides de la CAF existent pour les familles avec enfant handicap\xe9 ?",transport:"Comment obtenir un transport scolaire adapt\xe9 pour mon enfant ?"}[e];t&&(j(""),w(!1),await k(t))},L=e=>{let{message:t,index:s}=e,n="user"===t.role,o=b(t.timestamp);return(0,r.jsx)("div",{className:"flex ".concat(n?"justify-end":"justify-start"," mb-4"),children:(0,r.jsxs)("div",{className:"\n          max-w-[85%] rounded-2xl px-4 py-3 relative\n          ".concat(n?"bg-rose-500 text-white":"bg-white shadow-sm border border-slate-200","\n          ").concat(o?"animate-in slide-in-from-bottom-2 duration-300":"","\n        "),children:[!n&&(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(a.Z,{className:"h-4 w-4 text-rose-500"}),(0,r.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"Phoenix"}),(0,r.jsx)("span",{className:"text-xs text-slate-500",children:"• Conseiller expert"})]}),(0,r.jsx)("div",{className:"prose prose-sm max-w-none leading-relaxed ".concat(n?"text-white":"text-slate-800"),children:(0,r.jsx)(h.UG,{children:t.content})}),!n&&t.sources&&t.sources.length>0&&(0,r.jsxs)("div",{className:"mt-3 pt-2 border-t border-slate-100",children:[(0,r.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"\uD83D\uDCDA Sources consult\xe9es :"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:t.sources.map((e,t)=>(0,r.jsxs)("span",{className:"inline-block bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs border border-blue-200",children:["\uD83D\uDCC4 ",e.length>40?e.substring(0,40)+"...":e]},t))})]}),!n&&t.suggestions&&t.suggestions.length>0&&(0,r.jsxs)("div",{className:"mt-3 pt-2 border-t border-slate-100",children:[(0,r.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"\uD83D\uDCA1 Questions sugg\xe9r\xe9es :"}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:t.suggestions.map((e,t)=>(0,r.jsx)("button",{onClick:()=>{var t;j(e),null===(t=C.current)||void 0===t||t.focus()},className:"text-left text-sm bg-rose-50 hover:bg-rose-100 text-rose-700 px-3 py-2 rounded-lg transition-colors border border-rose-200 hover:border-rose-300",children:e},t))})]}),(0,r.jsxs)("div",{className:"text-xs mt-2 ".concat(n?"text-rose-100":"text-slate-400"),children:[g(t.timestamp),!n&&t.processing_time&&(0,r.jsxs)("span",{className:"ml-2",children:["• R\xe9ponse en ",t.processing_time.toFixed(1),"s"]})]}),!n&&s===E.length-1&&t.content.toLowerCase().includes("aeeh")&&(0,r.jsxs)("div",{className:"mt-3 pt-2 border-t border-slate-100",children:[(0,r.jsx)("div",{className:"text-xs text-slate-500 mb-2",children:"\uD83D\uDCA1 Questions fr\xe9quentes ensuite :"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)("button",{onClick:()=>k("Combien de temps pour avoir une r\xe9ponse MDPH ?"),className:"text-xs bg-rose-50 text-rose-700 px-2 py-1 rounded hover:bg-rose-100 transition-colors",children:"⏱️ D\xe9lais MDPH ?"}),(0,r.jsx)("button",{onClick:()=>k("Puis-je cumuler AEEH et allocations familiales ?"),className:"text-xs bg-rose-50 text-rose-700 px-2 py-1 rounded hover:bg-rose-100 transition-colors",children:"\uD83D\uDD04 Cumul possibles ?"}),(0,r.jsx)("button",{onClick:()=>k("Comment faire un recours si refus AEEH ?"),className:"text-xs bg-rose-50 text-rose-700 px-2 py-1 rounded hover:bg-rose-100 transition-colors",children:"⚖️ En cas de refus ?"})]})]}),!n&&s===E.length-1&&(0,r.jsx)("button",{onClick:()=>A(t.content,"helpful_response"),className:"absolute -bottom-2 -right-2 bg-rose-100 hover:bg-rose-200 text-rose-600 rounded-full p-1 transition-colors",title:"Sauvegarder cette r\xe9ponse",children:(0,r.jsx)(a.Z,{className:"h-3 w-3"})})]})})},q=()=>(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-4 bg-slate-50 rounded-lg mb-4",children:[(0,r.jsxs)("button",{onClick:()=>O("aeeh_calc"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"\uD83D\uDCB0 Calculer AEEH"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"Montants & \xe9ligibilit\xe9"})]}),(0,r.jsxs)("button",{onClick:()=>O("parent_solo"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"\uD83D\uDC69‍\uD83D\uDC67 Parent isol\xe9"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"Majorations sp\xe9ciales"})]}),(0,r.jsxs)("button",{onClick:()=>O("aesh_demande"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"\uD83C\uDFEB Demander AESH"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"\xc9cole & accompagnement"})]}),(0,r.jsxs)("button",{onClick:()=>O("dossier_mdph"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"\uD83D\uDCCB Dossier MDPH"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"Documents & d\xe9marches"})]}),(0,r.jsxs)("button",{onClick:()=>O("cumul_aides"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"\uD83D\uDD04 Cumul d'aides"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"AEEH + CAF + autres"})]}),(0,r.jsxs)("button",{onClick:()=>O("recours_mdph"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"⚖️ Recours MDPH"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"Refus & contestation"})]}),(0,r.jsxs)("button",{onClick:()=>O("caf_handicap"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"\uD83C\uDFDB️ Aides CAF"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"Allocations familiales"})]}),(0,r.jsxs)("button",{onClick:()=>O("transport"),className:"p-3 text-left rounded-xl border border-slate-200 hover:border-rose-300 hover:bg-white transition-all",children:[(0,r.jsx)("div",{className:"font-medium text-slate-800",children:"\uD83D\uDE8C Transport adapt\xe9"}),(0,r.jsx)("div",{className:"text-sm text-slate-600",children:"\xc9cole & d\xe9placements"})]})]});return(0,r.jsxs)("div",{className:"flex flex-col h-full bg-slate-50 ".concat(l),children:[(0,r.jsx)("div",{className:"bg-white border-b border-slate-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-rose-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(a.Z,{className:"h-5 w-5 text-rose-500"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-semibold text-slate-900",children:"Phoenix"}),(0,r.jsx)("p",{className:"text-sm text-slate-600",children:"Votre assistant empathique"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(()=>{let e={connected:{icon:o.Z,color:"text-green-500",text:"Connect\xe9"},connecting:{icon:i.Z,color:"text-yellow-500",text:"Connexion..."},disconnected:{icon:c.Z,color:"text-red-500",text:"D\xe9connect\xe9"}}[_],t=e.icon;return(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm ".concat(e.color),children:[(0,r.jsx)(t,{className:"h-4 w-4 ".concat("connecting"===_?"animate-spin":"")}),e.text]})},{}),(0,r.jsx)("button",{onClick:P,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"Nouvelle conversation",children:(0,r.jsx)(u,{className:"h-4 w-4"})})]})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[I&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(a.Z,{className:"h-8 w-8 text-rose-500"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Bonjour ! Je suis Phoenix \uD83D\uDD4A️"}),(0,r.jsxs)("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:[(0,r.jsx)("strong",{children:"Conseiller social expert"})," combinant l'expertise MDPH + CAF + droits parentaux. Je vous accompagne pour toutes vos d\xe9marches : AEEH, allocations, AESH, recours, et bien plus !"]}),(0,r.jsx)(q,{})]}),E.map((e,t)=>(0,r.jsx)(L,{message:e,index:t},e.id)),D&&(0,r.jsx)("div",{className:"flex justify-start mb-4",children:(0,r.jsxs)("div",{className:"bg-white shadow-sm border border-slate-200 rounded-2xl px-4 py-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(a.Z,{className:"h-4 w-4 text-rose-500"}),(0,r.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"Phoenix"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4 text-slate-400 animate-spin"}),(0,r.jsx)("span",{className:"text-slate-600",children:"Phoenix r\xe9fl\xe9chit..."})]})]})}),S&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-700 mb-2",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"font-medium",children:"Oups, une difficult\xe9 technique"})]}),(0,r.jsx)("p",{className:"text-red-600 text-sm mb-3",children:S}),(0,r.jsx)("button",{onClick:T,className:"bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-md text-sm transition-colors",children:"R\xe9essayer"})]}),(0,r.jsx)("div",{ref:N})]}),(0,r.jsxs)("div",{className:"bg-white border-t border-slate-200 px-6 py-4",children:[y&&!I&&(0,r.jsx)(q,{}),(0,r.jsxs)("form",{onSubmit:M,className:"flex gap-3",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("textarea",{ref:C,value:v,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M(e))},placeholder:"\xc9crivez votre message \xe0 Phoenix...",className:"w-full px-4 py-3 pr-12 border border-slate-300 rounded-xl resize-none focus:ring-2 focus:ring-rose-300 focus:border-rose-300 focus:outline-none transition-all",rows:1,style:{minHeight:"50px",maxHeight:"120px"},disabled:D}),!I&&(0,r.jsx)("button",{type:"button",onClick:()=>w(!y),className:"absolute right-3 top-3 p-1 text-slate-400 hover:text-slate-600 transition-colors",title:"Actions rapides",children:(0,r.jsx)(d.Z,{className:"h-4 w-4"})})]}),(0,r.jsx)("button",{type:"submit",disabled:!v.trim()||D,className:"bg-rose-500 hover:bg-rose-600 disabled:bg-slate-300 disabled:cursor-not-allowed text-white p-3 rounded-xl transition-colors focus:ring-2 focus:ring-rose-300 focus:outline-none",children:D?(0,r.jsx)(i.Z,{className:"h-5 w-5 animate-spin"}):(0,r.jsx)(m,{className:"h-5 w-5"})})]}),(0,r.jsx)("div",{className:"text-xs text-slate-500 mt-2 text-center",children:"Phoenix garde en m\xe9moire vos conversations pour mieux vous accompagner"})]})]})}var j=s(5706),y=s(8504),w=s(8304);function N(){let{user:e,loading:t}=(0,j.K)(),s=(0,y.useSearchParams)().get("q"),{aides:n}=(0,w.fN)(),{documents:a}=(0,w.GK)(),{deadlines:o}=(0,w.hT)(),{profile:i}=(0,w.mH)();return t?(0,r.jsx)("div",{className:"h-screen flex items-center justify-center bg-slate-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-rose-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-slate-600",children:"Chargement..."})]})}):(0,r.jsx)("div",{className:"h-screen",children:(0,r.jsx)(v,{userId:(null==e?void 0:e.id)||"anonymous",initialMessage:s||void 0,userContext:{aides:n,documents:a,deadlines:o,profile:i}})})}},5706:function(e,t,s){"use strict";s.d(t,{H:function(){return i},K:function(){return c}});var r=s(7821),n=s(8078),a=s(9905);let o=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[s,i]=(0,n.useState)(null),[c,l]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{a.supabase.auth.getSession().then(e=>{var t;let{data:{session:s}}=e;l(s),i(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),d(!1)});let{data:{subscription:e}}=a.supabase.auth.onAuthStateChange((e,t)=>{var s;l(t),i(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),d(!1)});return()=>e.unsubscribe()},[]);let m=async(e,t,s)=>{let{data:r,error:n}=await a.supabase.auth.signUp({email:e,password:t,options:{data:{name:s}}});return{data:r,error:n}},h=async(e,t)=>{let{data:s,error:r}=await a.supabase.auth.signInWithPassword({email:e,password:t});return{data:s,error:r}},x=async()=>{await a.supabase.auth.signOut()},p=async e=>{let{data:t,error:s}=await a.supabase.auth.resetPasswordForEmail(e);return{data:t,error:s}};return(0,r.jsx)(o.Provider,{value:{user:s,session:c,loading:u,signUp:m,signIn:h,signOut:x,resetPassword:p},children:t})}function c(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useSupabaseAuth must be used within an AuthProvider");return e}},8304:function(e,t,s){"use strict";s.d(t,{GK:function(){return i},fN:function(){return o},hT:function(){return c},mH:function(){return l}});var r=s(8078),n=s(9905),a=s(5706);function o(){let{user:e}=(0,a.K)(),[t,s]=(0,r.useState)([]),[o,i]=(0,r.useState)(!0),[c,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){i(!1);return}(async()=>{try{let{data:t,error:r}=await n.supabase.from("user_aides").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;s(t||[])}catch(e){l(e.message)}finally{i(!1)}})()},[e]),{aides:t,loading:o,error:c}}function i(){let{user:e}=(0,a.K)(),[t,s]=(0,r.useState)([]),[o,i]=(0,r.useState)(!0),[c,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){i(!1);return}(async()=>{try{let{data:t,error:r}=await n.supabase.from("user_documents").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;s(t||[])}catch(e){l(e.message)}finally{i(!1)}})()},[e]),{documents:t,loading:o,error:c}}function c(){let{user:e}=(0,a.K)(),[t,s]=(0,r.useState)([]),[o,i]=(0,r.useState)(!0),[c,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){i(!1);return}(async()=>{try{let{data:t,error:r}=await n.supabase.from("user_deadlines").select("*").eq("user_id",e.id).order("date",{ascending:!0});if(r)throw r;s(t||[])}catch(e){l(e.message)}finally{i(!1)}})()},[e]),{deadlines:t,loading:o,error:c}}function l(){let{user:e}=(0,a.K)(),[t,s]=(0,r.useState)(null),[o,i]=(0,r.useState)([]),[c,l]=(0,r.useState)(!0),[u,d]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){l(!1);return}(async()=>{try{let{data:t,error:r}=await n.supabase.from("family_profiles").select("*").eq("user_id",e.id).single();if(r&&"PGRST116"!==r.code)throw r;if(s(t),t){let{data:e,error:s}=await n.supabase.from("children").select("*").eq("family_id",t.id);if(s)throw s;i(e||[])}}catch(e){d(e.message)}finally{l(!1)}})()},[e]),{profile:t,children:o,loading:c,error:u}}},9905:function(e,t,s){"use strict";s.d(t,{supabase:function(){return o}});var r=s(1620);let n="https://gvginoszwaccifrtackh.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd2Z2lub3N6d2FjY2lmcnRhY2toIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxMjQyNzgsImV4cCI6MjA3NDcwMDI3OH0.sbuGET5VLfo0VjwVugc_ix1F_b0ntqDVmrqckdP22ss";if(!n||!a)throw Error("Missing Supabase environment variables");let o=(0,r.eI)(n,a,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce",storage:{getItem:e=>{var t;return(null===(t=document.cookie.split("; ").find(t=>t.startsWith("".concat(e,"="))))||void 0===t?void 0:t.split("=")[1])||null},setItem:(e,t)=>{document.cookie="".concat(e,"=").concat(t,"; path=/; max-age=31536000; SameSite=Lax")},removeItem:e=>{document.cookie="".concat(e,"=; path=/; max-age=0")}}}})},5338:function(e,t,s){"use strict";s.d(t,{P:function(){return r}});let r={nav:{home:"Accueil",login:"Connexion",dashboard:"Tableau de bord",children:"Enfants",documents:"Documents",consents:"Consentements",logout:"Se d\xe9connecter"},landing:{hero:{title:"PhoenixCare \uD83D\uDD4A️",subtitle:"Votre compagnon num\xe9rique pour accompagner votre enfant en situation de handicap",cta_primary:"Commencer maintenant",cta_secondary:"En savoir plus"},values:{title:"Pourquoi PhoenixCare ?",items:[{title:"Centralisation",description:"Tous vos documents et d\xe9marches au m\xeame endroit",icon:"FileText"},{title:"Simplicit\xe9",description:"Interface intuitive con\xe7ue pour les parents",icon:"Heart"},{title:"S\xe9curit\xe9",description:"Vos donn\xe9es prot\xe9g\xe9es et confidentielles",icon:"ShieldCheck"}]},howItWorks:{title:"Comment \xe7a marche ?",steps:[{title:"Cr\xe9ez votre compte",description:"Inscription simple et s\xe9curis\xe9e"},{title:"Ajoutez vos enfants",description:"Informations m\xe9dicales et administratives"},{title:"Importez vos documents",description:"Dossiers m\xe9dicaux, consentements, etc."},{title:"Partagez en toute s\xe9curit\xe9",description:"Avec les professionnels de sant\xe9"}]},testimonials:{title:"T\xe9moignages",items:[{quote:'"PhoenixCare m\'a fait gagner un temps pr\xe9cieux dans la gestion des papiers m\xe9dicaux de mon fils."',author:"Marie, m\xe8re d'un enfant autiste"},{quote:'"Enfin une solution simple pour partager les informations importantes avec l\'\xe9quipe m\xe9dicale."',author:"Pierre, p\xe8re d'une enfant trisomique"}]},faq:{title:"Questions fr\xe9quentes",items:[{question:"Mes donn\xe9es sont-elles s\xe9curis\xe9es ?",answer:"Oui, toutes vos donn\xe9es sont chiffr\xe9es et stock\xe9es de mani\xe8re s\xe9curis\xe9e, conform\xe9ment au RGPD."},{question:"Puis-je partager l'acc\xe8s avec les professionnels de sant\xe9 ?",answer:"Oui, vous pouvez cr\xe9er des acc\xe8s temporaires ou permanents selon vos besoins."},{question:"L'application est-elle gratuite ?",answer:"Oui, PhoenixCare est enti\xe8rement gratuit pour accompagner les familles."}]},footer:{cta:"Pr\xeat \xe0 simplifier votre quotidien ?",cta_button:"Cr\xe9er mon compte",copyright:"\xa9 2024 PhoenixCare. Tous droits r\xe9serv\xe9s."}},auth:{login:{title:"Se connecter \xe0 PhoenixCare",email:"Adresse email",password:"Mot de passe",submit:"Se connecter",forgot_password:"Mot de passe oubli\xe9 ?"},errors:{invalid_credentials:"Email ou mot de passe incorrect",network_error:"Erreur de connexion. Veuillez r\xe9essayer."}},dashboard:{welcome:"Bonjour, {name}",actions:{add_child:"Ajouter un enfant",import_document:"Importer un document",share_access:"Partager un acc\xe8s"},recent_activity:"Activit\xe9s r\xe9centes",no_activity:"Aucune activit\xe9 r\xe9cente"},children:{title:"Mes enfants",add_child:"Ajouter un enfant",no_children:"Aucun enfant enregistr\xe9",add_child_description:"Ajoutez les informations de votre enfant pour commencer",form:{first_name:"Pr\xe9nom",last_name:"Nom",birth_date:"Date de naissance",medical_info:"Informations m\xe9dicales",submit:"Enregistrer",cancel:"Annuler"}},documents:{title:"Mes documents",upload:"Importer un document",no_documents:"Aucun document",upload_description:"Glissez-d\xe9posez vos documents ici ou cliquez pour s\xe9lectionner",uploading:"T\xe9l\xe9chargement en cours...",success:"Document t\xe9l\xe9charg\xe9 avec succ\xe8s",error:"Erreur lors du t\xe9l\xe9chargement"},consents:{title:"Consentements",add_consent:"Nouveau consentement",no_consents:"Aucun consentement",recipient:"Destinataire",scope:"P\xe9rim\xe8tre",status:"Statut",statuses:{pending:"En attente",approved:"Approuv\xe9",rejected:"Refus\xe9",expired:"Expir\xe9"}},common:{loading:"Chargement...",error:"Une erreur est survenue",success:"Op\xe9ration r\xe9ussie",cancel:"Annuler",save:"Enregistrer",delete:"Supprimer",edit:"Modifier",search:"Rechercher",filter:"Filtrer",sort:"Trier",export:"Exporter",import:"Importer",download:"T\xe9l\xe9charger",upload:"T\xe9l\xe9charger",close:"Fermer",back:"Retour",next:"Suivant",previous:"Pr\xe9c\xe9dent",finish:"Terminer"},errors:{UNKNOWN_ERROR:"Une erreur inattendue est survenue. L'\xe9quipe technique a \xe9t\xe9 pr\xe9venue.",DB_FETCH_FAILED:"Je n'arrive pas \xe0 acc\xe9der aux informations pour le moment. Veuillez r\xe9essayer dans quelques instants.",AI_SERVICE_ERROR:"Mon service d'intelligence artificielle rencontre des difficult\xe9s. Veuillez patienter un peu avant de r\xe9essayer.",network:"Erreur de connexion. Veuillez v\xe9rifier votre connexion internet.",server:"Erreur serveur. Nos \xe9quipes ont \xe9t\xe9 notifi\xe9es.",validation:"Veuillez corriger les erreurs dans le formulaire.",unauthorized:"Vous n'\xeates pas autoris\xe9 \xe0 acc\xe9der \xe0 cette ressource.",not_found:"La page demand\xe9e n'existe pas.",forbidden:"Acc\xe8s interdit \xe0 cette resource."},success:{saved:"Modifications enregistr\xe9es avec succ\xe8s",deleted:"\xc9l\xe9ment supprim\xe9 avec succ\xe8s",uploaded:"Fichier t\xe9l\xe9charg\xe9 avec succ\xe8s",shared:"Acc\xe8s partag\xe9 avec succ\xe8s"}}},432:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(6576).Z)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]])}},function(e){e.O(0,[620,695,115,253,744],function(){return e(e.s=447)}),_N_E=e.O()}]);