(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[780],{981:function(e,t,s){Promise.resolve().then(s.bind(s,2796))},2796:function(e,t,s){"use strict";let r;s.r(t),s.d(t,{default:function(){return E}});var i=s(7821),n=s(2998),a=s(2252),c=s(1276),o=s(2243),l=s(1923),u=s(3506),h=s(8261),d=class extends o.l{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#s=(0,l.O)(),this.bindMethods(),this.setOptions(t)}#e;#r=void 0;#i=void 0;#n=void 0;#a;#c;#s;#t;#o;#l;#u;#h;#d;#p;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#r.addObserver(this),p(this.#r,this.options)?this.#m():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return f(this.#r,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return f(this.#r,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#g(),this.#v(),this.#r.removeObserver(this)}setOptions(e){let t=this.options,s=this.#r;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,u.Nc)(this.options.enabled,this.#r))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#x(),this.#r.setOptions(this.options),t._defaulted&&!(0,u.VS)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#r,observer:this});let r=this.hasListeners();r&&m(this.#r,s,this.options,t)&&this.#m(),this.updateResult(),r&&(this.#r!==s||(0,u.Nc)(this.options.enabled,this.#r)!==(0,u.Nc)(t.enabled,this.#r)||(0,u.KC)(this.options.staleTime,this.#r)!==(0,u.KC)(t.staleTime,this.#r))&&this.#b();let i=this.#R();r&&(this.#r!==s||(0,u.Nc)(this.options.enabled,this.#r)!==(0,u.Nc)(t.enabled,this.#r)||i!==this.#p)&&this.#j(i)}getOptimisticResult(e){let t=this.#e.getQueryCache().build(this.#e,e),s=this.createResult(t,e);return(0,u.VS)(this.getCurrentResult(),s)||(this.#n=s,this.#c=this.options,this.#a=this.#r.state),s}getCurrentResult(){return this.#n}trackResult(e,t){return new Proxy(e,{get:(e,s)=>(this.trackProp(s),t?.(s),"promise"!==s||this.options.experimental_prefetchInRender||"pending"!==this.#s.status||this.#s.reject(Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(e,s))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#r}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#m({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#m(e){this.#x();let t=this.#r.fetch(this.options,e);return e?.throwOnError||(t=t.catch(u.ZT)),t}#b(){this.#g();let e=(0,u.KC)(this.options.staleTime,this.#r);if(u.sk||this.#n.isStale||!(0,u.PN)(e))return;let t=(0,u.Kp)(this.#n.dataUpdatedAt,e);this.#h=h.mr.setTimeout(()=>{this.#n.isStale||this.updateResult()},t+1)}#R(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#r):this.options.refetchInterval)??!1}#j(e){this.#v(),this.#p=e,!u.sk&&!1!==(0,u.Nc)(this.options.enabled,this.#r)&&(0,u.PN)(this.#p)&&0!==this.#p&&(this.#d=h.mr.setInterval(()=>{(this.options.refetchIntervalInBackground||n.j.isFocused())&&this.#m()},this.#p))}#y(){this.#b(),this.#j(this.#R())}#g(){this.#h&&(h.mr.clearTimeout(this.#h),this.#h=void 0)}#v(){this.#d&&(h.mr.clearInterval(this.#d),this.#d=void 0)}createResult(e,t){let s;let r=this.#r,i=this.options,n=this.#n,a=this.#a,o=this.#c,h=e!==r?e.state:this.#i,{state:d}=e,f={...d},g=!1;if(t._optimisticResults){let s=this.hasListeners(),n=!s&&p(e,t),a=s&&m(e,r,t,i);(n||a)&&(f={...f,...(0,c.z)(d.data,e.options)}),"isRestoring"===t._optimisticResults&&(f.fetchStatus="idle")}let{error:v,errorUpdatedAt:x,status:b}=f;s=f.data;let R=!1;if(void 0!==t.placeholderData&&void 0===s&&"pending"===b){let e;n?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(e=n.data,R=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#u?.state.data,this.#u):t.placeholderData,void 0!==e&&(b="success",s=(0,u.oE)(n?.data,e,t),g=!0)}if(t.select&&void 0!==s&&!R){if(n&&s===a?.data&&t.select===this.#o)s=this.#l;else try{this.#o=t.select,s=t.select(s),s=(0,u.oE)(n?.data,s,t),this.#l=s,this.#t=null}catch(e){this.#t=e}}this.#t&&(v=this.#t,s=this.#l,x=Date.now(),b="error");let j="fetching"===f.fetchStatus,T="pending"===b,Q="error"===b,N=T&&j,C=void 0!==s,_={status:b,fetchStatus:f.fetchStatus,isPending:T,isSuccess:"success"===b,isError:Q,isInitialLoading:N,isLoading:N,data:s,dataUpdatedAt:f.dataUpdatedAt,error:v,errorUpdatedAt:x,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>h.dataUpdateCount||f.errorUpdateCount>h.errorUpdateCount,isFetching:j,isRefetching:j&&!T,isLoadingError:Q&&!C,isPaused:"paused"===f.fetchStatus,isPlaceholderData:g,isRefetchError:Q&&C,isStale:y(e,t),refetch:this.refetch,promise:this.#s,isEnabled:!1!==(0,u.Nc)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=e=>{"error"===_.status?e.reject(_.error):void 0!==_.data&&e.resolve(_.data)},s=()=>{t(this.#s=_.promise=(0,l.O)())},i=this.#s;switch(i.status){case"pending":e.queryHash===r.queryHash&&t(i);break;case"fulfilled":("error"===_.status||_.data!==i.value)&&s();break;case"rejected":("error"!==_.status||_.error!==i.reason)&&s()}}return _}updateResult(){let e=this.#n,t=this.createResult(this.#r,this.options);this.#a=this.#r.state,this.#c=this.options,void 0!==this.#a.data&&(this.#u=this.#r),(0,u.VS)(t,e)||(this.#n=t,this.#T({listeners:(()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!this.#f.size)return!0;let r=new Set(s??this.#f);return this.options.throwOnError&&r.add("error"),Object.keys(this.#n).some(t=>this.#n[t]!==e[t]&&r.has(t))})()}))}#x(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#r)return;let t=this.#r;this.#r=e,this.#i=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#T(e){a.Vr.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#n)}),this.#e.getQueryCache().notify({query:this.#r,type:"observerResultsUpdated"})})}};function p(e,t){return!1!==(0,u.Nc)(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)||void 0!==e.state.data&&f(e,t,t.refetchOnMount)}function f(e,t,s){if(!1!==(0,u.Nc)(t.enabled,e)&&"static"!==(0,u.KC)(t.staleTime,e)){let r="function"==typeof s?s(e):s;return"always"===r||!1!==r&&y(e,t)}return!1}function m(e,t,s,r){return(e!==t||!1===(0,u.Nc)(r.enabled,e))&&(!s.suspense||"error"!==e.state.status)&&y(e,s)}function y(e,t){return!1!==(0,u.Nc)(t.enabled,e)&&e.isStaleByTime((0,u.KC)(t.staleTime,e))}var g=s(8078),v=s(8191),x=g.createContext((r=!1,{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r})),b=()=>g.useContext(x),R=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&!t.isReset()&&(e.retryOnMount=!1)},j=e=>{g.useEffect(()=>{e.clearReset()},[e])},T=e=>{let{result:t,errorResetBoundary:s,throwOnError:r,query:i,suspense:n}=e;return t.isError&&!s.isReset()&&!t.isFetching&&i&&(n&&void 0===t.data||(0,u.L3)(r,[t.error,i]))},Q=g.createContext(!1),N=()=>g.useContext(Q);Q.Provider;var C=e=>{if(e.suspense){let t=e=>"static"===e?e:Math.max(e??1e3,1e3),s=e.staleTime;e.staleTime="function"==typeof s?(...e)=>t(s(...e)):t(s),"number"==typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,1e3))}},_=(e,t)=>e.isLoading&&e.isFetching&&!t,w=(e,t)=>e?.suspense&&t.isPending,D=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function I(e,t){return function(e,t,s){var r,i,n,c,o;let l=N(),h=b(),d=(0,v.NL)(s),p=d.defaultQueryOptions(e);null===(i=d.getDefaultOptions().queries)||void 0===i||null===(r=i._experimental_beforeQuery)||void 0===r||r.call(i,p),p._optimisticResults=l?"isRestoring":"optimistic",C(p),R(p,h),j(h);let f=!d.getQueryCache().get(p.queryHash),[m]=g.useState(()=>new t(d,p)),y=m.getOptimisticResult(p),x=!l&&!1!==e.subscribed;if(g.useSyncExternalStore(g.useCallback(e=>{let t=x?m.subscribe(a.Vr.batchCalls(e)):u.ZT;return m.updateResult(),t},[m,x]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),g.useEffect(()=>{m.setOptions(p)},[p,m]),w(p,y))throw D(p,m,h);if(T({result:y,errorResetBoundary:h,throwOnError:p.throwOnError,query:d.getQueryCache().get(p.queryHash),suspense:p.suspense}))throw y.error;if(null===(c=d.getDefaultOptions().queries)||void 0===c||null===(n=c._experimental_afterQuery)||void 0===n||n.call(c,p,y),p.experimental_prefetchInRender&&!u.sk&&_(y,l)){let e=f?D(p,m,h):null===(o=d.getQueryCache().get(p.queryHash))||void 0===o?void 0:o.promise;null==e||e.catch(u.ZT).finally(()=>{m.updateResult()})}return p.notifyOnChangeProps?y:m.trackResult(y)}(e,d,t)}let O=s(2949).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";function E(){let{data:e,isLoading:t}=I({queryKey:["analytics","overview"],queryFn:async()=>{let e=await fetch("".concat(O,"/api/analytics/overview"));if(!e.ok)throw Error("Failed to fetch analytics overview");return e.json()},staleTime:3e5,refetchInterval:3e5}),{data:s,isLoading:r}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return I({queryKey:["analytics","top-questions",e],queryFn:async()=>{let t=await fetch("".concat(O,"/api/analytics/top-questions?limit=").concat(e));if(!t.ok)throw Error("Failed to fetch top questions");return t.json()},staleTime:6e5})}(10),{data:n,isLoading:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return I({queryKey:["analytics","knowledge-gaps",e],queryFn:async()=>{let t=await fetch("".concat(O,"/api/analytics/knowledge-gaps?limit=").concat(e));if(!t.ok)throw Error("Failed to fetch knowledge gaps");return t.json()},staleTime:6e5})}(10);return t?(0,i.jsxs)("div",{className:"p-8",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"\uD83D\uDCCA Analytics Dashboard"}),(0,i.jsx)("p",{children:"Chargement..."})]}):(0,i.jsxs)("div",{className:"p-8 max-w-7xl mx-auto",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"\uD83D\uDCCA Analytics Dashboard"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,i.jsx)(S,{title:"Interactions (30j)",value:(null==e?void 0:e.total_interactions_30d)||0,icon:"\uD83D\uDCAC"}),(0,i.jsx)(S,{title:"Utilisateurs uniques",value:(null==e?void 0:e.unique_users_30d)||0,icon:"\uD83D\uDC65"}),(0,i.jsx)(S,{title:"Cache Hit Rate",value:"".concat((null==e?void 0:e.avg_cache_hit_rate)||0,"%"),icon:"⚡"}),(0,i.jsx)(S,{title:"Temps de r\xe9ponse",value:"".concat(Math.round((null==e?void 0:e.avg_response_time_ms)||0),"ms"),icon:"⏱️"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,i.jsxs)("section",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"\uD83D\uDCC8 Top Questions"}),r?(0,i.jsx)("p",{children:"Chargement..."}):(0,i.jsx)("div",{className:"space-y-3",children:s&&s.length>0?s.map((e,t)=>(0,i.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4 py-2",children:[(0,i.jsx)("p",{className:"font-medium text-sm",children:e.question}),(0,i.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.count," fois • ",Math.round(e.avg_time_ms),"ms"]})]},t)):(0,i.jsx)("p",{className:"text-gray-500",children:"Aucune donn\xe9e disponible"})})]}),(0,i.jsxs)("section",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"\uD83D\uDD0D Gaps Knowledge Base"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Questions sans sources → Docs \xe0 ajouter"}),a?(0,i.jsx)("p",{children:"Chargement..."}):(0,i.jsx)("div",{className:"space-y-3",children:n&&n.length>0?n.map((e,t)=>(0,i.jsxs)("div",{className:"border-l-4 border-red-500 pl-4 py-2",children:[(0,i.jsx)("p",{className:"font-medium text-sm",children:e.question}),(0,i.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.count," fois • ",new Date(e.created_at).toLocaleDateString("fr-FR")]})]},t)):(0,i.jsx)("p",{className:"text-green-600",children:"✅ Aucun gap d\xe9tect\xe9 ! Toutes les questions ont des sources."})})]})]}),(0,i.jsxs)("section",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,i.jsx)("h3",{className:"font-bold text-lg mb-3",children:"\uD83D\uDCA1 Actions Recommand\xe9es"}),(0,i.jsxs)("ul",{className:"space-y-2 text-sm",children:[n&&n.length>0&&(0,i.jsxs)("li",{className:"flex items-start gap-2",children:[(0,i.jsx)("span",{className:"text-red-500",children:"⚠️"}),(0,i.jsxs)("span",{children:[(0,i.jsxs)("strong",{children:[n.length," questions sans sources"]})," - Ajouter des documents pour combler ces gaps"]})]}),e&&e.avg_cache_hit_rate<50&&(0,i.jsxs)("li",{className:"flex items-start gap-2",children:[(0,i.jsx)("span",{className:"text-yellow-500",children:"⚠️"}),(0,i.jsxs)("span",{children:[(0,i.jsxs)("strong",{children:["Cache hit rate faible (",e.avg_cache_hit_rate,"%)"]})," - Optimiser le cache TTL"]})]}),e&&e.avg_response_time_ms>3e3&&(0,i.jsxs)("li",{className:"flex items-start gap-2",children:[(0,i.jsx)("span",{className:"text-yellow-500",children:"⚠️"}),(0,i.jsxs)("span",{children:[(0,i.jsxs)("strong",{children:["Temps de r\xe9ponse \xe9lev\xe9 (",Math.round(e.avg_response_time_ms),"ms)"]})," - Envisager optimisation RAG"]})]}),(!n||0===n.length)&&e&&e.avg_cache_hit_rate>=50&&e.avg_response_time_ms<=3e3&&(0,i.jsxs)("li",{className:"flex items-start gap-2",children:[(0,i.jsx)("span",{className:"text-green-500",children:"✅"}),(0,i.jsxs)("span",{children:[(0,i.jsx)("strong",{children:"Tout est optimal !"})," Continue comme \xe7a \uD83D\uDE80"]})]})]})]})]})}function S(e){let{title:t,value:s,icon:r}=e;return(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("p",{className:"text-sm text-gray-600",children:t}),(0,i.jsx)("span",{className:"text-2xl",children:r})]}),(0,i.jsx)("p",{className:"text-3xl font-bold",children:s})]})}},2949:function(e,t,s){"use strict";var r,i;e.exports=(null==(r=s.g.process)?void 0:r.env)&&"object"==typeof(null==(i=s.g.process)?void 0:i.env)?s.g.process:s(3862)},3862:function(e){!function(){var t={229:function(e){var t,s,r,i=e.exports={};function n(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{s="function"==typeof clearTimeout?clearTimeout:a}catch(e){s=a}}();var o=[],l=!1,u=-1;function h(){l&&r&&(l=!1,r.length?o=r.concat(o):u=-1,o.length&&d())}function d(){if(!l){var e=c(h);l=!0;for(var t=o.length;t;){for(r=o,o=[];++u<t;)r&&r[u].run();u=-1,t=o.length}r=null,l=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===a||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];o.push(new p(e,t)),1!==o.length||l||c(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},s={};function r(e){var i=s[e];if(void 0!==i)return i.exports;var n=s[e]={exports:{}},a=!0;try{t[e](n,n.exports,r),a=!1}finally{a&&delete s[e]}return n.exports}r.ab="//";var i=r(229);e.exports=i}()}},function(e){e.O(0,[210,115,571,744],function(){return e(e.s=981)}),_N_E=e.O()}]);