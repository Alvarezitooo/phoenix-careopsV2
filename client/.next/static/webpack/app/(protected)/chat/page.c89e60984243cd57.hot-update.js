"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/(protected)/chat/page",{

/***/ "(app-pages-browser)/./hooks/useChat.ts":
/*!**************************!*\
  !*** ./hooks/useChat.ts ***!
  \**************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useChat: function() { return /* binding */ useChat; }\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(app-pages-browser)/../node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_uiCopy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/uiCopy */ \"(app-pages-browser)/./lib/uiCopy.ts\");\n/* __next_internal_client_entry_do_not_use__ useChat auto */ \n\n// Helper pour gÃ©rer les erreurs de l'API\nasync function getApiErrorMessage(error) {\n    if (error.response) {\n        try {\n            var _data_error;\n            const data = await error.response.json();\n            const errorCode = (_data_error = data.error) === null || _data_error === void 0 ? void 0 : _data_error.code;\n            if (errorCode && _lib_uiCopy__WEBPACK_IMPORTED_MODULE_1__.uiCopy.errors[errorCode]) {\n                return _lib_uiCopy__WEBPACK_IMPORTED_MODULE_1__.uiCopy.errors[errorCode];\n            }\n        } catch (e) {\n            // Le corps de la rÃ©ponse n'est pas un JSON valide\n            return _lib_uiCopy__WEBPACK_IMPORTED_MODULE_1__.uiCopy.errors.UNKNOWN_ERROR;\n        }\n    }\n    if (error.message.includes(\"Failed to fetch\")) {\n        return _lib_uiCopy__WEBPACK_IMPORTED_MODULE_1__.uiCopy.errors.network;\n    }\n    return _lib_uiCopy__WEBPACK_IMPORTED_MODULE_1__.uiCopy.errors.UNKNOWN_ERROR;\n}\nfunction useChat() {\n    let options = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {};\n    const { userId, autoLoadHistory = true, userContext } = options;\n    const [state, setState] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({\n        messages: [],\n        isLoading: false,\n        error: null,\n        connectionStatus: \"disconnected\"\n    });\n    const abortControllerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    // ðŸ“œ Charger l'historique au montage\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (autoLoadHistory && userId) {\n            loadChatHistory();\n        }\n    }, [\n        userId,\n        autoLoadHistory\n    ]);\n    // ðŸ“œ Charger historique conversation\n    const loadChatHistory = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async ()=>{\n        if (!userId) {\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: false,\n                    connectionStatus: \"disconnected\"\n                }));\n            return;\n        }\n        try {\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: true,\n                    connectionStatus: \"connecting\"\n                }));\n            const response = await fetch(\"/api/chat/history?userId=\".concat(userId));\n            if (!response.ok) {\n                throw {\n                    response\n                }; // Lancer l'objet rÃ©ponse pour analyse\n            }\n            const data = await response.json();\n            setState((prev)=>({\n                    ...prev,\n                    messages: data.messages || [],\n                    isLoading: false,\n                    connectionStatus: \"connected\",\n                    error: null\n                }));\n        } catch (error) {\n            console.error(\"Erreur chargement historique:\", error);\n            const errorMessage = await getApiErrorMessage(error);\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: false,\n                    connectionStatus: \"disconnected\",\n                    error: errorMessage\n                }));\n        }\n    }, [\n        userId\n    ]);\n    // ðŸ’¬ Envoyer un message\n    const sendMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async (content)=>{\n        if (!content.trim() || state.isLoading || !userId) {\n            return;\n        }\n        // Annuler requÃªte prÃ©cÃ©dente si elle existe\n        if (abortControllerRef.current) {\n            abortControllerRef.current.abort();\n        }\n        abortControllerRef.current = new AbortController();\n        // Message utilisateur immÃ©diat\n        const userMessage = {\n            id: \"user-\".concat(Date.now()),\n            role: \"user\",\n            content: content.trim(),\n            timestamp: new Date().toISOString()\n        };\n        setState((prev)=>({\n                ...prev,\n                messages: [\n                    ...prev.messages,\n                    userMessage\n                ],\n                isLoading: true,\n                error: null\n            }));\n        try {\n            const response = await fetch(\"/api/chat/message\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    message: content.trim(),\n                    userId,\n                    context: userContext // Envoyer le contexte utilisateur\n                }),\n                signal: abortControllerRef.current.signal\n            });\n            if (!response.ok) {\n                throw {\n                    response\n                }; // Lancer l'objet rÃ©ponse pour analyse\n            }\n            const data = await response.json();\n            // Message assistant avec donnÃ©es RAG\n            const assistantMessage = {\n                id: \"assistant-\".concat(Date.now()),\n                role: \"assistant\",\n                content: data.response || data.answer,\n                timestamp: data.timestamp,\n                sources: data.sources || [],\n                processing_time: data.processing_time || 0,\n                suggestions: data.suggestions || []\n            };\n            setState((prev)=>({\n                    ...prev,\n                    messages: [\n                        ...prev.messages,\n                        assistantMessage\n                    ],\n                    isLoading: false,\n                    connectionStatus: \"connected\"\n                }));\n        } catch (error) {\n            if (error.name === \"AbortError\") {\n                return; // RequÃªte annulÃ©e volontairement\n            }\n            console.error(\"Erreur envoi message:\", error);\n            const errorMessage = await getApiErrorMessage(error);\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: false,\n                    connectionStatus: \"disconnected\",\n                    error: errorMessage\n                }));\n        }\n    }, [\n        userId,\n        state.isLoading\n    ]);\n    // ðŸ”„ Reset conversation\n    const resetConversation = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async ()=>{\n        if (!userId) {\n            return;\n        }\n        try {\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: true\n                }));\n            const response = await fetch(\"/api/chat/reset\", {\n                method: \"DELETE\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    userId\n                })\n            });\n            if (!response.ok) {\n                throw new Error(\"Erreur lors de la r\\xe9initialisation\");\n            }\n            setState((prev)=>({\n                    ...prev,\n                    messages: [],\n                    isLoading: false,\n                    error: null\n                }));\n        } catch (error) {\n            console.error(\"Erreur reset:\", error);\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: false,\n                    error: error.message\n                }));\n        }\n    }, [\n        userId\n    ]);\n    // ðŸ§  Sauvegarder un souvenir important\n    const saveMemory = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async function(memory) {\n        let type = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : \"important\";\n        if (!userId) {\n            return false;\n        }\n        try {\n            const response = await fetch(\"/api/chat/memory\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    userId,\n                    memory,\n                    type\n                })\n            });\n            if (!response.ok) {\n                throw new Error(\"Erreur sauvegarde m\\xe9moire\");\n            }\n            return true;\n        } catch (error) {\n            console.error(\"Erreur sauvegarde m\\xe9moire:\", error);\n            return false;\n        }\n    }, [\n        userId\n    ]);\n    // ðŸ“„ Analyser un document\n    const analyzeDocument = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async (document, documentType)=>{\n        if (!userId) {\n            return null;\n        }\n        try {\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: true\n                }));\n            const response = await fetch(\"/api/chat/analyze-document\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    document,\n                    userId,\n                    documentType\n                })\n            });\n            if (!response.ok) {\n                throw new Error(\"Erreur analyse document\");\n            }\n            const data = await response.json();\n            // Ajouter rÃ©sultat d'analyse comme message\n            const analysisMessage = {\n                id: \"analysis-\".concat(Date.now()),\n                role: \"assistant\",\n                content: \"\\uD83D\\uDCC4 **Analyse de votre document :**\\n\\n\".concat(data.analysis, \"\\n\\n**Suggestions :**\\n\").concat(data.suggestions.map((s)=>\"â€¢ \".concat(s)).join(\"\\n\")),\n                timestamp: new Date().toISOString()\n            };\n            setState((prev)=>({\n                    ...prev,\n                    messages: [\n                        ...prev.messages,\n                        analysisMessage\n                    ],\n                    isLoading: false\n                }));\n            return data;\n        } catch (error) {\n            console.error(\"Erreur analyse document:\", error);\n            setState((prev)=>({\n                    ...prev,\n                    isLoading: false,\n                    error: error.message\n                }));\n            return null;\n        }\n    }, [\n        userId\n    ]);\n    // ðŸ”„ Retry derniÃ¨re action en cas d'erreur\n    const retry = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{\n        if (state.messages.length > 0) {\n            const lastUserMessage = [\n                ...state.messages\n            ].reverse().find((m)=>m.role === \"user\");\n            if (lastUserMessage) {\n                // Supprimer les messages d'erreur et relancer\n                setState((prev)=>({\n                        ...prev,\n                        messages: prev.messages.filter((m)=>!m.id.startsWith(\"error-\")),\n                        error: null\n                    }));\n                sendMessage(lastUserMessage.content);\n            }\n        }\n    }, [\n        state.messages,\n        sendMessage\n    ]);\n    return {\n        // State\n        messages: state.messages,\n        isLoading: state.isLoading,\n        error: state.error,\n        connectionStatus: state.connectionStatus,\n        // Actions\n        sendMessage,\n        resetConversation,\n        saveMemory,\n        analyzeDocument,\n        loadChatHistory,\n        retry,\n        // Utils\n        isEmpty: state.messages.length === 0,\n        lastMessage: state.messages[state.messages.length - 1] || null\n    };\n}\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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d0JBQ1BMLFVBQVVLLEtBQUtMLFFBQVEsQ0FBQ3VELE1BQU0sQ0FBQ0QsQ0FBQUEsSUFBSyxDQUFDQSxFQUFFckMsRUFBRSxDQUFDdUMsVUFBVSxDQUFDO3dCQUNyRDNFLE9BQU87b0JBQ1Q7Z0JBQ0E2QixZQUFZeUMsZ0JBQWdCeEMsT0FBTztZQUNyQztRQUNGO0lBQ0YsR0FBRztRQUFDYixNQUFNRSxRQUFRO1FBQUVVO0tBQVk7SUFFaEMsT0FBTztRQUNMLFFBQVE7UUFDUlYsVUFBVUYsTUFBTUUsUUFBUTtRQUN4QkMsV0FBV0gsTUFBTUcsU0FBUztRQUMxQnBCLE9BQU9pQixNQUFNakIsS0FBSztRQUNsQnFCLGtCQUFrQkosTUFBTUksZ0JBQWdCO1FBRXhDLFVBQVU7UUFDVlE7UUFDQTBCO1FBQ0FFO1FBQ0FHO1FBQ0FyQztRQUNBNkM7UUFFQSxRQUFRO1FBQ1JRLFNBQVMzRCxNQUFNRSxRQUFRLENBQUNrRCxNQUFNLEtBQUs7UUFDbkNRLGFBQWE1RCxNQUFNRSxRQUFRLENBQUNGLE1BQU1FLFFBQVEsQ0FBQ2tELE1BQU0sR0FBRyxFQUFFLElBQUk7SUFDNUQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9ob29rcy91c2VDaGF0LnRzP2MyZGIiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBjbGllbnQnO1xuXG5pbXBvcnQgeyB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2ssIHVzZVJlZiwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyB1aUNvcHkgfSBmcm9tICdAL2xpYi91aUNvcHknO1xuXG5pbnRlcmZhY2UgTWVzc2FnZSB7XG4gIGlkOiBzdHJpbmc7XG4gIHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xuICBzb3VyY2VzPzogc3RyaW5nW107XG4gIHByb2Nlc3NpbmdfdGltZT86IG51bWJlcjtcbiAgc3VnZ2VzdGlvbnM/OiBzdHJpbmdbXTtcbn1cblxuaW50ZXJmYWNlIENoYXRTdGF0ZSB7XG4gIG1lc3NhZ2VzOiBNZXNzYWdlW107XG4gIGlzTG9hZGluZzogYm9vbGVhbjtcbiAgZXJyb3I6IHN0cmluZyB8IG51bGw7XG4gIGNvbm5lY3Rpb25TdGF0dXM6ICdjb25uZWN0ZWQnIHwgJ2Rpc2Nvbm5lY3RlZCcgfCAnY29ubmVjdGluZyc7XG59XG5cbmludGVyZmFjZSBVc2VDaGF0T3B0aW9ucyB7XG4gIHVzZXJJZD86IHN0cmluZztcbiAgYXV0b0xvYWRIaXN0b3J5PzogYm9vbGVhbjtcbiAgdXNlckNvbnRleHQ/OiBhbnk7XG59XG5cbi8vIEhlbHBlciBwb3VyIGfDqXJlciBsZXMgZXJyZXVycyBkZSBsJ0FQSVxuYXN5bmMgZnVuY3Rpb24gZ2V0QXBpRXJyb3JNZXNzYWdlKGVycm9yOiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xuICBpZiAoZXJyb3IucmVzcG9uc2UpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGVycm9yLnJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGNvbnN0IGVycm9yQ29kZSA9IGRhdGEuZXJyb3I/LmNvZGUgYXMga2V5b2YgdHlwZW9mIHVpQ29weS5lcnJvcnM7XG4gICAgICBpZiAoZXJyb3JDb2RlICYmIHVpQ29weS5lcnJvcnNbZXJyb3JDb2RlXSkge1xuICAgICAgICByZXR1cm4gdWlDb3B5LmVycm9yc1tlcnJvckNvZGVdO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIExlIGNvcnBzIGRlIGxhIHLDqXBvbnNlIG4nZXN0IHBhcyB1biBKU09OIHZhbGlkZVxuICAgICAgcmV0dXJuIHVpQ29weS5lcnJvcnMuVU5LTk9XTl9FUlJPUjtcbiAgICB9XG4gIH1cbiAgaWYgKGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0ZhaWxlZCB0byBmZXRjaCcpKSB7XG4gICAgcmV0dXJuIHVpQ29weS5lcnJvcnMubmV0d29yaztcbiAgfVxuICByZXR1cm4gdWlDb3B5LmVycm9ycy5VTktOT1dOX0VSUk9SO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlQ2hhdChvcHRpb25zOiBVc2VDaGF0T3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IHsgdXNlcklkLCBhdXRvTG9hZEhpc3RvcnkgPSB0cnVlLCB1c2VyQ29udGV4dCB9ID0gb3B0aW9ucztcblxuICBjb25zdCBbc3RhdGUsIHNldFN0YXRlXSA9IHVzZVN0YXRlPENoYXRTdGF0ZT4oe1xuICAgIG1lc3NhZ2VzOiBbXSxcbiAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgIGVycm9yOiBudWxsLFxuICAgIGNvbm5lY3Rpb25TdGF0dXM6ICdkaXNjb25uZWN0ZWQnXG4gIH0pO1xuXG4gIGNvbnN0IGFib3J0Q29udHJvbGxlclJlZiA9IHVzZVJlZjxBYm9ydENvbnRyb2xsZXIgfCBudWxsPihudWxsKTtcblxuICAvLyDwn5OcIENoYXJnZXIgbCdoaXN0b3JpcXVlIGF1IG1vbnRhZ2VcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoYXV0b0xvYWRIaXN0b3J5ICYmIHVzZXJJZCkge1xuICAgICAgbG9hZENoYXRIaXN0b3J5KCk7XG4gICAgfVxuICB9LCBbdXNlcklkLCBhdXRvTG9hZEhpc3RvcnldKTtcblxuICAvLyDwn5OcIENoYXJnZXIgaGlzdG9yaXF1ZSBjb252ZXJzYXRpb25cbiAgY29uc3QgbG9hZENoYXRIaXN0b3J5ID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICBzZXRTdGF0ZSgocHJldikgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgY29ubmVjdGlvblN0YXR1czogJ2Rpc2Nvbm5lY3RlZCcsXG4gICAgICB9KSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHsgLi4ucHJldiwgaXNMb2FkaW5nOiB0cnVlLCBjb25uZWN0aW9uU3RhdHVzOiAnY29ubmVjdGluZycgfSkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAvYXBpL2NoYXQvaGlzdG9yeT91c2VySWQ9JHt1c2VySWR9YCk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgeyByZXNwb25zZSB9OyAvLyBMYW5jZXIgbCdvYmpldCByw6lwb25zZSBwb3VyIGFuYWx5c2VcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgICAuLi5wcmV2LFxuICAgICAgICBtZXNzYWdlczogZGF0YS5tZXNzYWdlcyB8fCBbXSxcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgY29ubmVjdGlvblN0YXR1czogJ2Nvbm5lY3RlZCcsXG4gICAgICAgIGVycm9yOiBudWxsXG4gICAgICB9KSk7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyZXVyIGNoYXJnZW1lbnQgaGlzdG9yaXF1ZTonLCBlcnJvcik7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBhd2FpdCBnZXRBcGlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgICAuLi5wcmV2LFxuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICBjb25uZWN0aW9uU3RhdHVzOiAnZGlzY29ubmVjdGVkJyxcbiAgICAgICAgZXJyb3I6IGVycm9yTWVzc2FnZVxuICAgICAgfSkpO1xuICAgIH1cbiAgfSwgW3VzZXJJZF0pO1xuXG4gIC8vIPCfkqwgRW52b3llciB1biBtZXNzYWdlXG4gIGNvbnN0IHNlbmRNZXNzYWdlID0gdXNlQ2FsbGJhY2soYXN5bmMgKGNvbnRlbnQ6IHN0cmluZykgPT4ge1xuICAgIGlmICghY29udGVudC50cmltKCkgfHwgc3RhdGUuaXNMb2FkaW5nIHx8ICF1c2VySWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBbm51bGVyIHJlcXXDqnRlIHByw6ljw6lkZW50ZSBzaSBlbGxlIGV4aXN0ZVxuICAgIGlmIChhYm9ydENvbnRyb2xsZXJSZWYuY3VycmVudCkge1xuICAgICAgYWJvcnRDb250cm9sbGVyUmVmLmN1cnJlbnQuYWJvcnQoKTtcbiAgICB9XG5cbiAgICBhYm9ydENvbnRyb2xsZXJSZWYuY3VycmVudCA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcblxuICAgIC8vIE1lc3NhZ2UgdXRpbGlzYXRldXIgaW1tw6lkaWF0XG4gICAgY29uc3QgdXNlck1lc3NhZ2U6IE1lc3NhZ2UgPSB7XG4gICAgICBpZDogYHVzZXItJHtEYXRlLm5vdygpfWAsXG4gICAgICByb2xlOiAndXNlcicsXG4gICAgICBjb250ZW50OiBjb250ZW50LnRyaW0oKSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcblxuICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgIC4uLnByZXYsXG4gICAgICBtZXNzYWdlczogWy4uLnByZXYubWVzc2FnZXMsIHVzZXJNZXNzYWdlXSxcbiAgICAgIGlzTG9hZGluZzogdHJ1ZSxcbiAgICAgIGVycm9yOiBudWxsXG4gICAgfSkpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvY2hhdC9tZXNzYWdlJywge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBtZXNzYWdlOiBjb250ZW50LnRyaW0oKSxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgY29udGV4dDogdXNlckNvbnRleHQgLy8gRW52b3llciBsZSBjb250ZXh0ZSB1dGlsaXNhdGV1clxuICAgICAgICB9KSxcbiAgICAgICAgc2lnbmFsOiBhYm9ydENvbnRyb2xsZXJSZWYuY3VycmVudC5zaWduYWwsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyB7IHJlc3BvbnNlIH07IC8vIExhbmNlciBsJ29iamV0IHLDqXBvbnNlIHBvdXIgYW5hbHlzZVxuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAvLyBNZXNzYWdlIGFzc2lzdGFudCBhdmVjIGRvbm7DqWVzIFJBR1xuICAgICAgY29uc3QgYXNzaXN0YW50TWVzc2FnZTogTWVzc2FnZSA9IHtcbiAgICAgICAgaWQ6IGBhc3Npc3RhbnQtJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHJvbGU6ICdhc3Npc3RhbnQnLFxuICAgICAgICBjb250ZW50OiBkYXRhLnJlc3BvbnNlIHx8IGRhdGEuYW5zd2VyLFxuICAgICAgICB0aW1lc3RhbXA6IGRhdGEudGltZXN0YW1wLFxuICAgICAgICBzb3VyY2VzOiBkYXRhLnNvdXJjZXMgfHwgW10sXG4gICAgICAgIHByb2Nlc3NpbmdfdGltZTogZGF0YS5wcm9jZXNzaW5nX3RpbWUgfHwgMCxcbiAgICAgICAgc3VnZ2VzdGlvbnM6IGRhdGEuc3VnZ2VzdGlvbnMgfHwgW11cbiAgICAgIH07XG5cbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgbWVzc2FnZXM6IFsuLi5wcmV2Lm1lc3NhZ2VzLCBhc3Npc3RhbnRNZXNzYWdlXSxcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgY29ubmVjdGlvblN0YXR1czogJ2Nvbm5lY3RlZCdcbiAgICAgIH0pKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHtcbiAgICAgICAgcmV0dXJuOyAvLyBSZXF1w6p0ZSBhbm51bMOpZSB2b2xvbnRhaXJlbWVudFxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJldXIgZW52b2kgbWVzc2FnZTonLCBlcnJvcik7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBhd2FpdCBnZXRBcGlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuXG4gICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgIGNvbm5lY3Rpb25TdGF0dXM6ICdkaXNjb25uZWN0ZWQnLFxuICAgICAgICBlcnJvcjogZXJyb3JNZXNzYWdlXG4gICAgICB9KSk7XG4gICAgfVxuICB9LCBbdXNlcklkLCBzdGF0ZS5pc0xvYWRpbmddKTtcblxuICAvLyDwn5SEIFJlc2V0IGNvbnZlcnNhdGlvblxuICBjb25zdCByZXNldENvbnZlcnNhdGlvbiA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgc2V0U3RhdGUocHJldiA9PiAoeyAuLi5wcmV2LCBpc0xvYWRpbmc6IHRydWUgfSkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2NoYXQvcmVzZXQnLCB7XG4gICAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgdXNlcklkXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJldXIgbG9ycyBkZSBsYSByw6lpbml0aWFsaXNhdGlvbicpO1xuICAgICAgfVxuXG4gICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IG51bGxcbiAgICAgIH0pKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciByZXNldDonLCBlcnJvcik7XG4gICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlXG4gICAgICB9KSk7XG4gICAgfVxuICB9LCBbdXNlcklkXSk7XG5cbiAgLy8g8J+noCBTYXV2ZWdhcmRlciB1biBzb3V2ZW5pciBpbXBvcnRhbnRcbiAgY29uc3Qgc2F2ZU1lbW9yeSA9IHVzZUNhbGxiYWNrKGFzeW5jIChtZW1vcnk6IHN0cmluZywgdHlwZTogc3RyaW5nID0gJ2ltcG9ydGFudCcpID0+IHtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2FwaS9jaGF0L21lbW9yeScsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIG1lbW9yeSxcbiAgICAgICAgICB0eXBlXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJldXIgc2F1dmVnYXJkZSBtw6ltb2lyZScpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyZXVyIHNhdXZlZ2FyZGUgbcOpbW9pcmU6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSwgW3VzZXJJZF0pO1xuXG4gIC8vIPCfk4QgQW5hbHlzZXIgdW4gZG9jdW1lbnRcbiAgY29uc3QgYW5hbHl6ZURvY3VtZW50ID0gdXNlQ2FsbGJhY2soYXN5bmMgKGRvY3VtZW50OiBzdHJpbmcsIGRvY3VtZW50VHlwZTogc3RyaW5nKSA9PiB7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgc2V0U3RhdGUocHJldiA9PiAoeyAuLi5wcmV2LCBpc0xvYWRpbmc6IHRydWUgfSkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2NoYXQvYW5hbHl6ZS1kb2N1bWVudCcsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgZG9jdW1lbnQsXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIGRvY3VtZW50VHlwZVxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyZXVyIGFuYWx5c2UgZG9jdW1lbnQnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgLy8gQWpvdXRlciByw6lzdWx0YXQgZCdhbmFseXNlIGNvbW1lIG1lc3NhZ2VcbiAgICAgIGNvbnN0IGFuYWx5c2lzTWVzc2FnZTogTWVzc2FnZSA9IHtcbiAgICAgICAgaWQ6IGBhbmFseXNpcy0ke0RhdGUubm93KCl9YCxcbiAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgIGNvbnRlbnQ6IGDwn5OEICoqQW5hbHlzZSBkZSB2b3RyZSBkb2N1bWVudCA6KipcXG5cXG4ke2RhdGEuYW5hbHlzaXN9XFxuXFxuKipTdWdnZXN0aW9ucyA6KipcXG4ke2RhdGEuc3VnZ2VzdGlvbnMubWFwKChzOiBzdHJpbmcpID0+IGDigKIgJHtzfWApLmpvaW4oJ1xcbicpfWAsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9O1xuXG4gICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIG1lc3NhZ2VzOiBbLi4ucHJldi5tZXNzYWdlcywgYW5hbHlzaXNNZXNzYWdlXSxcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZVxuICAgICAgfSkpO1xuXG4gICAgICByZXR1cm4gZGF0YTtcblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0VycmV1ciBhbmFseXNlIGRvY3VtZW50OicsIGVycm9yKTtcbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH0pKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSwgW3VzZXJJZF0pO1xuXG4gIC8vIPCflIQgUmV0cnkgZGVybmnDqHJlIGFjdGlvbiBlbiBjYXMgZCdlcnJldXJcbiAgY29uc3QgcmV0cnkgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKHN0YXRlLm1lc3NhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGxhc3RVc2VyTWVzc2FnZSA9IFsuLi5zdGF0ZS5tZXNzYWdlc10ucmV2ZXJzZSgpLmZpbmQobSA9PiBtLnJvbGUgPT09ICd1c2VyJyk7XG4gICAgICBpZiAobGFzdFVzZXJNZXNzYWdlKSB7XG4gICAgICAgIC8vIFN1cHByaW1lciBsZXMgbWVzc2FnZXMgZCdlcnJldXIgZXQgcmVsYW5jZXJcbiAgICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgbWVzc2FnZXM6IHByZXYubWVzc2FnZXMuZmlsdGVyKG0gPT4gIW0uaWQuc3RhcnRzV2l0aCgnZXJyb3ItJykpLFxuICAgICAgICAgIGVycm9yOiBudWxsXG4gICAgICAgIH0pKTtcbiAgICAgICAgc2VuZE1lc3NhZ2UobGFzdFVzZXJNZXNzYWdlLmNvbnRlbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfSwgW3N0YXRlLm1lc3NhZ2VzLCBzZW5kTWVzc2FnZV0pO1xuXG4gIHJldHVybiB7XG4gICAgLy8gU3RhdGVcbiAgICBtZXNzYWdlczogc3RhdGUubWVzc2FnZXMsXG4gICAgaXNMb2FkaW5nOiBzdGF0ZS5pc0xvYWRpbmcsXG4gICAgZXJyb3I6IHN0YXRlLmVycm9yLFxuICAgIGNvbm5lY3Rpb25TdGF0dXM6IHN0YXRlLmNvbm5lY3Rpb25TdGF0dXMsXG5cbiAgICAvLyBBY3Rpb25zXG4gICAgc2VuZE1lc3NhZ2UsXG4gICAgcmVzZXRDb252ZXJzYXRpb24sXG4gICAgc2F2ZU1lbW9yeSxcbiAgICBhbmFseXplRG9jdW1lbnQsXG4gICAgbG9hZENoYXRIaXN0b3J5LFxuICAgIHJldHJ5LFxuXG4gICAgLy8gVXRpbHNcbiAgICBpc0VtcHR5OiBzdGF0ZS5tZXNzYWdlcy5sZW5ndGggPT09IDAsXG4gICAgbGFzdE1lc3NhZ2U6IHN0YXRlLm1lc3NhZ2VzW3N0YXRlLm1lc3NhZ2VzLmxlbmd0aCAtIDFdIHx8IG51bGxcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJ1c2VTdGF0ZSIsInVzZUNhbGxiYWNrIiwidXNlUmVmIiwidXNlRWZmZWN0IiwidWlDb3B5IiwiZ2V0QXBpRXJyb3JNZXNzYWdlIiwiZXJyb3IiLCJyZXNwb25zZSIsImRhdGEiLCJqc29uIiwiZXJyb3JDb2RlIiwiY29kZSIsImVycm9ycyIsImUiLCJVTktOT1dOX0VSUk9SIiwibWVzc2FnZSIsImluY2x1ZGVzIiwibmV0d29yayIsInVzZUNoYXQiLCJvcHRpb25zIiwidXNlcklkIiwiYXV0b0xvYWRIaXN0b3J5IiwidXNlckNvbnRleHQiLCJzdGF0ZSIsInNldFN0YXRlIiwibWVzc2FnZXMiLCJpc0xvYWRpbmciLCJjb25uZWN0aW9uU3RhdHVzIiwiYWJvcnRDb250cm9sbGVyUmVmIiwibG9hZENoYXRIaXN0b3J5IiwicHJldiIsImZldGNoIiwib2siLCJjb25zb2xlIiwiZXJyb3JNZXNzYWdlIiwic2VuZE1lc3NhZ2UiLCJjb250ZW50IiwidHJpbSIsImN1cnJlbnQiLCJhYm9ydCIsIkFib3J0Q29udHJvbGxlciIsInVzZXJNZXNzYWdlIiwiaWQiLCJEYXRlIiwibm93Iiwicm9sZSIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY29udGV4dCIsInNpZ25hbCIsImFzc2lzdGFudE1lc3NhZ2UiLCJhbnN3ZXIiLCJzb3VyY2VzIiwicHJvY2Vzc2luZ190aW1lIiwic3VnZ2VzdGlvbnMiLCJuYW1lIiwicmVzZXRDb252ZXJzYXRpb24iLCJFcnJvciIsInNhdmVNZW1vcnkiLCJtZW1vcnkiLCJ0eXBlIiwiYW5hbHl6ZURvY3VtZW50IiwiZG9jdW1lbnQiLCJkb2N1bWVudFR5cGUiLCJhbmFseXNpc01lc3NhZ2UiLCJhbmFseXNpcyIsIm1hcCIsInMiLCJqb2luIiwicmV0cnkiLCJsZW5ndGgiLCJsYXN0VXNlck1lc3NhZ2UiLCJyZXZlcnNlIiwiZmluZCIsIm0iLCJmaWx0ZXIiLCJzdGFydHNXaXRoIiwiaXNFbXB0eSIsImxhc3RNZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(app-pages-browser)/./hooks/useChat.ts\n"));

/***/ })

});